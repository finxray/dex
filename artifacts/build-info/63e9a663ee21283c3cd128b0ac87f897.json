{"id":"63e9a663ee21283c3cd128b0ac87f897","_format":"hh-sol-build-info-1","solcVersion":"0.8.30","solcLongVersion":"0.8.30+commit.73712a01","input":{"language":"Solidity","sources":{"contracts/Peripheral/libraries/InventorySkew.sol":{"content":"// SPDX-License-Identifier: MIT\npragma solidity ^0.8.30;\n\n/// @title InventorySkew\n/// @notice Calculates normalized inventory skew for Avellaneda-Stoikov market making\n/// @dev Implements inventory skew calculation that produces values in range [-1, +1]\n///      representing LP's deviation from desired inventory position\nlibrary InventorySkew {\n\n    /// @notice Inventory skew modes defining which asset is considered risky\n    /// @dev Determines how inventory imbalance is calculated\n    enum RiskyAssetMode {\n        NEUTRAL,    // Value-neutral: q = inventory0 - inventory1_in_asset0\n        RISKY0,     // Asset0 is risky: q = inventory0\n        RISKY1      // Asset1 is risky: q = inventory1_in_asset0\n    }\n\n    /// @notice Calculate inventory skew based on value-weighted inventory deviation from target\n    /// @dev Computes skew as the change in inventory imbalance due to the trade:\n    ///      \n    ///      Logic:\n    ///      1. Convert both inventories to common value (asset0 terms) using midPrice\n    ///      2. Calculate skew before trade based on risky asset mode\n    ///      3. Calculate skew after trade (simulate trade effect)\n    ///      4. For RISKY0/RISKY1: skew = skew_after - skew_before\n    ///      5. For NEUTRAL: skew = abs(skew_before) - abs(skew_after) (improvement metric)\n    ///      \n    ///      Skew formulas by mode:\n    ///      - NEUTRAL: skew = (value0 / [(value0 + value1)/2]) - 1\n    ///      - RISKY0: skew = value0 / (value0 + value1)\n    ///      - RISKY1: skew = value1 / (value0 + value1)\n    ///      \n    ///      where values are in asset0 terms: value0 = inv0, value1 = inv1 * midPrice\n    ///\n    /// @param inventory0Raw Current inventory of asset0\n    /// @param inventory1Raw Current inventory of asset1\n    /// @param amount Trade amount in input asset units\n    /// @param zeroForOne Trade direction (true = asset0→asset1, false = asset1→asset0)\n    /// @param riskyMode Determines which asset is considered risky\n    /// @param midPricePpb Mid price (asset0/asset1) in PPB - how many asset1 per asset0\n    /// @return skew Trade-induced skew change in range [-1e9, +1e9] in PPB\n    function calculateSkew(\n        uint256 inventory0Raw,\n        uint256 inventory1Raw,\n        uint256 amount,\n        bool zeroForOne,\n        RiskyAssetMode riskyMode,\n        uint256 midPricePpb\n    ) internal pure returns (int256 skew) {\n        // Calculate value0 and value1 in asset0 terms\n        // midPrice is asset0/asset1 (how many asset1 per asset0)\n        // So: value0 = inventory0, value1 = inventory1 / midPrice\n        uint256 value0Before = inventory0Raw;\n        uint256 value1Before = (inventory1Raw * 1e9) / midPricePpb; // Convert to asset0 terms\n        \n        // Simulate trade effect\n        uint256 value0After;\n        uint256 value1After;\n        \n        if (zeroForOne) {\n            // Selling asset0 for asset1\n            value0After = inventory0Raw > amount ? inventory0Raw - amount : 0;\n            // Buying asset1: receive (amount × midPrice) of asset1, convert to asset0 terms\n            uint256 receivedAsset1 = (amount * midPricePpb) / 1e9;\n            uint256 receivedAsset1InAsset0 = (receivedAsset1 * 1e9) / midPricePpb;\n            value1After = value1Before + receivedAsset1InAsset0;\n        } else {\n            // Selling asset1 for asset0\n            // Convert amount (in asset1) to asset0 terms for comparison\n            uint256 amountInAsset0 = (amount * 1e9) / midPricePpb;\n            value1After = value1Before > amountInAsset0 ? value1Before - amountInAsset0 : 0;\n            // Buying asset0: receive amount/midPrice of asset0\n            uint256 receivedAsset0 = (amount * 1e9) / midPricePpb;\n            value0After = inventory0Raw + receivedAsset0;\n        }\n        \n        // Calculate skew before and after\n        int256 skewBefore = _calculateSkewAtState(value0Before, value1Before, riskyMode);\n        int256 skewAfter = _calculateSkewAtState(value0After, value1After, riskyMode);\n        \n        // For all cases: skew = skew_after - skew_before\n        // For NEUTRAL: use abs values\n        if (riskyMode == RiskyAssetMode.NEUTRAL) {\n            int256 absSkewBefore = skewBefore >= 0 ? skewBefore : -skewBefore;\n            int256 absSkewAfter = skewAfter >= 0 ? skewAfter : -skewAfter;\n            skew = absSkewAfter - absSkewBefore; // Positive if imbalance increased\n        } else {\n            skew = skewAfter - skewBefore;\n        }\n        \n        // Clamp to [-1e9, +1e9]\n        if (skew > 1e9) return 1e9;\n        if (skew < -1e9) return -1e9;\n        return skew;\n    }\n\n    /// @notice Calculate skew at a given inventory state\n    /// @dev Internal helper for before/after comparison\n    function _calculateSkewAtState(\n        uint256 value0,\n        uint256 value1,\n        RiskyAssetMode riskyMode\n    ) private pure returns (int256 skewPpb) {\n        uint256 totalValue = value0 + value1;\n        if (totalValue == 0) return 0;\n        \n        if (riskyMode == RiskyAssetMode.NEUTRAL) {\n            // NEUTRAL: skew = (value0 / [(value0 + value1)/2]) - 1\n            // = (2*value0 / totalValue) - 1\n            int256 ratio = (int256(value0) * 2 * 1e9) / int256(totalValue);\n            return ratio - 1e9; // Subtract 1.0 in PPB\n            \n        } else if (riskyMode == RiskyAssetMode.RISKY0) {\n            // RISKY0: skew = value0 / (value0 + value1)\n            return (int256(value0) * 1e9) / int256(totalValue);\n            \n        } else { // RISKY1\n            // RISKY1: skew = value1 / (value0 + value1)\n            return (int256(value1) * 1e9) / int256(totalValue);\n        }\n    }\n\n    /// @notice Calculate half-spread with inventory adjustment, ensuring non-negative result\n    /// @dev Implements the full A-S spread formula with safety constraint:\n    ///      Half_Spread = max(0, 1/k - gam/(2*k²) + (gam*σ²)/2 + q*gam*σ²)\n    ///      \n    ///      The last term (q*gam*σ²) can be negative for beneficial trades, potentially\n    ///      making the spread negative. We enforce Half_Spread >= 0 to prevent invalid quotes.\n    ///\n    /// @param invKPpb The 1/k term in PPB (base spread)\n    /// @param term2Ppb The gam/(2*k²) term in PPB  \n    /// @param term3Ppb The (gam*σ²)/2 term in PPB\n    /// @param skewPpb The inventory skew in range [-1e9, +1e9]\n    /// @param gammaStDev2Ppb The gam*σ² product in PPB (for inventory adjustment)\n    /// @return halfSpreadPpb The final half-spread in PPB, guaranteed >= 0\n    function calculateHalfSpreadWithInventory(\n        uint32 invKPpb,\n        uint32 term2Ppb,\n        uint32 term3Ppb,\n        int256 skewPpb,\n        uint32 gammaStDev2Ppb\n    ) internal pure returns (uint32 halfSpreadPpb) {\n        // Calculate inventory adjustment: q * gam * σ²\n        // skewPpb is in [-1e9, +1e9] (actual value × 1e9)\n        // gammaStDev2Ppb is in PPB (actual value × 1e9)\n        // We want result in same units as invKPpb (bps × 1e5)\n        // (skewPpb / 1e9) * (gammaStDev2Ppb / 1e9) * 1e5 = (skewPpb * gammaStDev2Ppb) / (1e9 * 1e4)\n        int256 inventoryAdjustmentPpb = (skewPpb * int256(uint256(gammaStDev2Ppb))) / 1e13;\n        \n        // Calculate base spread: 1/k - gam/(2*k²) + (gam*σ²)/2\n        int256 baseSpread = int256(uint256(invKPpb)) - int256(uint256(term2Ppb)) + int256(uint256(term3Ppb));\n        \n        // Add inventory adjustment\n        int256 finalSpread = baseSpread + inventoryAdjustmentPpb;\n        \n        // Enforce non-negativity\n        if (finalSpread < 0) return 0;\n        \n        return uint32(uint256(finalSpread));\n    }\n\n}\n\n"},"contracts/Peripheral/libraries/tests/InventorySkewTest.sol":{"content":"// SPDX-License-Identifier: MIT\npragma solidity ^0.8.30;\n\nimport \"../InventorySkew.sol\";\n\n/// @title InventorySkewTest\n/// @notice Test harness for InventorySkew library\ncontract InventorySkewTest {\n    function calculateSkew(\n        uint256 inventory0Raw,\n        uint256 inventory1Raw,\n        uint256 amount,\n        bool zeroForOne,\n        uint8 riskyModeUint,\n        uint256 midPricePpb\n    ) external pure returns (int256) {\n        InventorySkew.RiskyAssetMode riskyMode = InventorySkew.RiskyAssetMode(riskyModeUint);\n        return InventorySkew.calculateSkew(\n            inventory0Raw,\n            inventory1Raw,\n            amount,\n            zeroForOne,\n            riskyMode,\n            midPricePpb\n        );\n    }\n\n    function calculateHalfSpreadWithInventory(\n        uint32 invKPpb,\n        uint32 term2Ppb,\n        uint32 term3Ppb,\n        int256 skewPpb,\n        uint32 gammaStDev2Ppb\n    ) external pure returns (uint32) {\n        return InventorySkew.calculateHalfSpreadWithInventory(\n            invKPpb,\n            term2Ppb,\n            term3Ppb,\n            skewPpb,\n            gammaStDev2Ppb\n        );\n    }\n}\n\n"}},"settings":{"optimizer":{"enabled":true,"runs":200},"viaIR":true,"evmVersion":"cancun","outputSelection":{"*":{"*":["abi","evm.bytecode","evm.deployedBytecode","evm.methodIdentifiers","metadata"],"":["ast"]}}}},"output":{"sources":{"contracts/Peripheral/libraries/InventorySkew.sol":{"ast":{"absolutePath":"contracts/Peripheral/libraries/InventorySkew.sol","exportedSymbols":{"InventorySkew":[356]},"id":357,"license":"MIT","nodeType":"SourceUnit","nodes":[{"id":1,"literals":["solidity","^","0.8",".30"],"nodeType":"PragmaDirective","src":"32:24:0"},{"abstract":false,"baseContracts":[],"canonicalName":"InventorySkew","contractDependencies":[],"contractKind":"library","documentation":{"id":2,"nodeType":"StructuredDocumentation","src":"58:266:0","text":"@title InventorySkew\n @notice Calculates normalized inventory skew for Avellaneda-Stoikov market making\n @dev Implements inventory skew calculation that produces values in range [-1, +1]\n      representing LP's deviation from desired inventory position"},"fullyImplemented":true,"id":356,"linearizedBaseContracts":[356],"name":"InventorySkew","nameLocation":"332:13:0","nodeType":"ContractDefinition","nodes":[{"canonicalName":"InventorySkew.RiskyAssetMode","documentation":{"id":3,"nodeType":"StructuredDocumentation","src":"353:135:0","text":"@notice Inventory skew modes defining which asset is considered risky\n @dev Determines how inventory imbalance is calculated"},"id":7,"members":[{"id":4,"name":"NEUTRAL","nameLocation":"523:7:0","nodeType":"EnumValue","src":"523:7:0"},{"id":5,"name":"RISKY0","nameLocation":"599:6:0","nodeType":"EnumValue","src":"599:6:0"},{"id":6,"name":"RISKY1","nameLocation":"654:6:0","nodeType":"EnumValue","src":"654:6:0"}],"name":"RiskyAssetMode","nameLocation":"498:14:0","nodeType":"EnumDefinition","src":"493:223:0"},{"body":{"id":190,"nodeType":"Block","src":"2393:2221:0","statements":[{"assignments":[27],"declarations":[{"constant":false,"id":27,"mutability":"mutable","name":"value0Before","nameLocation":"2599:12:0","nodeType":"VariableDeclaration","scope":190,"src":"2591:20:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":26,"name":"uint256","nodeType":"ElementaryTypeName","src":"2591:7:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"}],"id":29,"initialValue":{"id":28,"name":"inventory0Raw","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":10,"src":"2614:13:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"VariableDeclarationStatement","src":"2591:36:0"},{"assignments":[31],"declarations":[{"constant":false,"id":31,"mutability":"mutable","name":"value1Before","nameLocation":"2645:12:0","nodeType":"VariableDeclaration","scope":190,"src":"2637:20:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":30,"name":"uint256","nodeType":"ElementaryTypeName","src":"2637:7:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"}],"id":38,"initialValue":{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":37,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"components":[{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":34,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":32,"name":"inventory1Raw","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":12,"src":"2661:13:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"*","rightExpression":{"hexValue":"316539","id":33,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"2677:3:0","typeDescriptions":{"typeIdentifier":"t_rational_1000000000_by_1","typeString":"int_const 1000000000"},"value":"1e9"},"src":"2661:19:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"id":35,"isConstant":false,"isInlineArray":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"TupleExpression","src":"2660:21:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"/","rightExpression":{"id":36,"name":"midPricePpb","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":21,"src":"2684:11:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"2660:35:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"VariableDeclarationStatement","src":"2637:58:0"},{"assignments":[40],"declarations":[{"constant":false,"id":40,"mutability":"mutable","name":"value0After","nameLocation":"2782:11:0","nodeType":"VariableDeclaration","scope":190,"src":"2774:19:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":39,"name":"uint256","nodeType":"ElementaryTypeName","src":"2774:7:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"}],"id":41,"nodeType":"VariableDeclarationStatement","src":"2774:19:0"},{"assignments":[43],"declarations":[{"constant":false,"id":43,"mutability":"mutable","name":"value1After","nameLocation":"2811:11:0","nodeType":"VariableDeclaration","scope":190,"src":"2803:19:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":42,"name":"uint256","nodeType":"ElementaryTypeName","src":"2803:7:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"}],"id":44,"nodeType":"VariableDeclarationStatement","src":"2803:19:0"},{"condition":{"id":45,"name":"zeroForOne","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":16,"src":"2845:10:0","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"falseBody":{"id":117,"nodeType":"Block","src":"3303:474:0","statements":[{"assignments":[83],"declarations":[{"constant":false,"id":83,"mutability":"mutable","name":"amountInAsset0","nameLocation":"3439:14:0","nodeType":"VariableDeclaration","scope":117,"src":"3431:22:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":82,"name":"uint256","nodeType":"ElementaryTypeName","src":"3431:7:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"}],"id":90,"initialValue":{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":89,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"components":[{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":86,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":84,"name":"amount","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":14,"src":"3457:6:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"*","rightExpression":{"hexValue":"316539","id":85,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"3466:3:0","typeDescriptions":{"typeIdentifier":"t_rational_1000000000_by_1","typeString":"int_const 1000000000"},"value":"1e9"},"src":"3457:12:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"id":87,"isConstant":false,"isInlineArray":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"TupleExpression","src":"3456:14:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"/","rightExpression":{"id":88,"name":"midPricePpb","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":21,"src":"3473:11:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"3456:28:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"VariableDeclarationStatement","src":"3431:53:0"},{"expression":{"id":100,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"id":91,"name":"value1After","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":43,"src":"3498:11:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"Assignment","operator":"=","rightHandSide":{"condition":{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":94,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":92,"name":"value1Before","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":31,"src":"3512:12:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":">","rightExpression":{"id":93,"name":"amountInAsset0","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":83,"src":"3527:14:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"3512:29:0","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"falseExpression":{"hexValue":"30","id":98,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"3576:1:0","typeDescriptions":{"typeIdentifier":"t_rational_0_by_1","typeString":"int_const 0"},"value":"0"},"id":99,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"Conditional","src":"3512:65:0","trueExpression":{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":97,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":95,"name":"value1Before","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":31,"src":"3544:12:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"-","rightExpression":{"id":96,"name":"amountInAsset0","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":83,"src":"3559:14:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"3544:29:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"3498:79:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"id":101,"nodeType":"ExpressionStatement","src":"3498:79:0"},{"assignments":[103],"declarations":[{"constant":false,"id":103,"mutability":"mutable","name":"receivedAsset0","nameLocation":"3663:14:0","nodeType":"VariableDeclaration","scope":117,"src":"3655:22:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":102,"name":"uint256","nodeType":"ElementaryTypeName","src":"3655:7:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"}],"id":110,"initialValue":{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":109,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"components":[{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":106,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":104,"name":"amount","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":14,"src":"3681:6:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"*","rightExpression":{"hexValue":"316539","id":105,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"3690:3:0","typeDescriptions":{"typeIdentifier":"t_rational_1000000000_by_1","typeString":"int_const 1000000000"},"value":"1e9"},"src":"3681:12:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"id":107,"isConstant":false,"isInlineArray":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"TupleExpression","src":"3680:14:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"/","rightExpression":{"id":108,"name":"midPricePpb","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":21,"src":"3697:11:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"3680:28:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"VariableDeclarationStatement","src":"3655:53:0"},{"expression":{"id":115,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"id":111,"name":"value0After","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":40,"src":"3722:11:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"Assignment","operator":"=","rightHandSide":{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":114,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":112,"name":"inventory0Raw","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":10,"src":"3736:13:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"+","rightExpression":{"id":113,"name":"receivedAsset0","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":103,"src":"3752:14:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"3736:30:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"3722:44:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"id":116,"nodeType":"ExpressionStatement","src":"3722:44:0"}]},"id":118,"nodeType":"IfStatement","src":"2841:936:0","trueBody":{"id":81,"nodeType":"Block","src":"2857:440:0","statements":[{"expression":{"id":55,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"id":46,"name":"value0After","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":40,"src":"2912:11:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"Assignment","operator":"=","rightHandSide":{"condition":{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":49,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":47,"name":"inventory0Raw","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":10,"src":"2926:13:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":">","rightExpression":{"id":48,"name":"amount","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":14,"src":"2942:6:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"2926:22:0","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"falseExpression":{"hexValue":"30","id":53,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"2976:1:0","typeDescriptions":{"typeIdentifier":"t_rational_0_by_1","typeString":"int_const 0"},"value":"0"},"id":54,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"Conditional","src":"2926:51:0","trueExpression":{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":52,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":50,"name":"inventory0Raw","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":10,"src":"2951:13:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"-","rightExpression":{"id":51,"name":"amount","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":14,"src":"2967:6:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"2951:22:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"2912:65:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"id":56,"nodeType":"ExpressionStatement","src":"2912:65:0"},{"assignments":[58],"declarations":[{"constant":false,"id":58,"mutability":"mutable","name":"receivedAsset1","nameLocation":"3093:14:0","nodeType":"VariableDeclaration","scope":81,"src":"3085:22:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":57,"name":"uint256","nodeType":"ElementaryTypeName","src":"3085:7:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"}],"id":65,"initialValue":{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":64,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"components":[{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":61,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":59,"name":"amount","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":14,"src":"3111:6:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"*","rightExpression":{"id":60,"name":"midPricePpb","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":21,"src":"3120:11:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"3111:20:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"id":62,"isConstant":false,"isInlineArray":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"TupleExpression","src":"3110:22:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"/","rightExpression":{"hexValue":"316539","id":63,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"3135:3:0","typeDescriptions":{"typeIdentifier":"t_rational_1000000000_by_1","typeString":"int_const 1000000000"},"value":"1e9"},"src":"3110:28:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"VariableDeclarationStatement","src":"3085:53:0"},{"assignments":[67],"declarations":[{"constant":false,"id":67,"mutability":"mutable","name":"receivedAsset1InAsset0","nameLocation":"3160:22:0","nodeType":"VariableDeclaration","scope":81,"src":"3152:30:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":66,"name":"uint256","nodeType":"ElementaryTypeName","src":"3152:7:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"}],"id":74,"initialValue":{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":73,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"components":[{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":70,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":68,"name":"receivedAsset1","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":58,"src":"3186:14:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"*","rightExpression":{"hexValue":"316539","id":69,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"3203:3:0","typeDescriptions":{"typeIdentifier":"t_rational_1000000000_by_1","typeString":"int_const 1000000000"},"value":"1e9"},"src":"3186:20:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"id":71,"isConstant":false,"isInlineArray":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"TupleExpression","src":"3185:22:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"/","rightExpression":{"id":72,"name":"midPricePpb","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":21,"src":"3210:11:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"3185:36:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"VariableDeclarationStatement","src":"3152:69:0"},{"expression":{"id":79,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"id":75,"name":"value1After","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":43,"src":"3235:11:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"Assignment","operator":"=","rightHandSide":{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":78,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":76,"name":"value1Before","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":31,"src":"3249:12:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"+","rightExpression":{"id":77,"name":"receivedAsset1InAsset0","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":67,"src":"3264:22:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"3249:37:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"3235:51:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"id":80,"nodeType":"ExpressionStatement","src":"3235:51:0"}]}},{"assignments":[120],"declarations":[{"constant":false,"id":120,"mutability":"mutable","name":"skewBefore","nameLocation":"3845:10:0","nodeType":"VariableDeclaration","scope":190,"src":"3838:17:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"},"typeName":{"id":119,"name":"int256","nodeType":"ElementaryTypeName","src":"3838:6:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"visibility":"internal"}],"id":126,"initialValue":{"arguments":[{"id":122,"name":"value0Before","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":27,"src":"3880:12:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},{"id":123,"name":"value1Before","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":31,"src":"3894:12:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},{"id":124,"name":"riskyMode","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":19,"src":"3908:9:0","typeDescriptions":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint256","typeString":"uint256"},{"typeIdentifier":"t_uint256","typeString":"uint256"},{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"}],"id":121,"name":"_calculateSkewAtState","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":277,"src":"3858:21:0","typeDescriptions":{"typeIdentifier":"t_function_internal_pure$_t_uint256_$_t_uint256_$_t_enum$_RiskyAssetMode_$7_$returns$_t_int256_$","typeString":"function (uint256,uint256,enum InventorySkew.RiskyAssetMode) pure returns (int256)"}},"id":125,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"3858:60:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"VariableDeclarationStatement","src":"3838:80:0"},{"assignments":[128],"declarations":[{"constant":false,"id":128,"mutability":"mutable","name":"skewAfter","nameLocation":"3935:9:0","nodeType":"VariableDeclaration","scope":190,"src":"3928:16:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"},"typeName":{"id":127,"name":"int256","nodeType":"ElementaryTypeName","src":"3928:6:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"visibility":"internal"}],"id":134,"initialValue":{"arguments":[{"id":130,"name":"value0After","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":40,"src":"3969:11:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},{"id":131,"name":"value1After","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":43,"src":"3982:11:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},{"id":132,"name":"riskyMode","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":19,"src":"3995:9:0","typeDescriptions":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint256","typeString":"uint256"},{"typeIdentifier":"t_uint256","typeString":"uint256"},{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"}],"id":129,"name":"_calculateSkewAtState","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":277,"src":"3947:21:0","typeDescriptions":{"typeIdentifier":"t_function_internal_pure$_t_uint256_$_t_uint256_$_t_enum$_RiskyAssetMode_$7_$returns$_t_int256_$","typeString":"function (uint256,uint256,enum InventorySkew.RiskyAssetMode) pure returns (int256)"}},"id":133,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"3947:58:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"VariableDeclarationStatement","src":"3928:77:0"},{"condition":{"commonType":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"},"id":138,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":135,"name":"riskyMode","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":19,"src":"4125:9:0","typeDescriptions":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"}},"nodeType":"BinaryOperation","operator":"==","rightExpression":{"expression":{"id":136,"name":"RiskyAssetMode","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":7,"src":"4138:14:0","typeDescriptions":{"typeIdentifier":"t_type$_t_enum$_RiskyAssetMode_$7_$","typeString":"type(enum InventorySkew.RiskyAssetMode)"}},"id":137,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"memberLocation":"4153:7:0","memberName":"NEUTRAL","nodeType":"MemberAccess","referencedDeclaration":4,"src":"4138:22:0","typeDescriptions":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"}},"src":"4125:35:0","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"falseBody":{"id":172,"nodeType":"Block","src":"4417:54:0","statements":[{"expression":{"id":170,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"id":166,"name":"skew","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":24,"src":"4431:4:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"Assignment","operator":"=","rightHandSide":{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":169,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":167,"name":"skewAfter","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":128,"src":"4438:9:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":"-","rightExpression":{"id":168,"name":"skewBefore","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":120,"src":"4450:10:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"src":"4438:22:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"src":"4431:29:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"id":171,"nodeType":"ExpressionStatement","src":"4431:29:0"}]},"id":173,"nodeType":"IfStatement","src":"4121:350:0","trueBody":{"id":165,"nodeType":"Block","src":"4162:249:0","statements":[{"assignments":[140],"declarations":[{"constant":false,"id":140,"mutability":"mutable","name":"absSkewBefore","nameLocation":"4183:13:0","nodeType":"VariableDeclaration","scope":165,"src":"4176:20:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"},"typeName":{"id":139,"name":"int256","nodeType":"ElementaryTypeName","src":"4176:6:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"visibility":"internal"}],"id":148,"initialValue":{"condition":{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":143,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":141,"name":"skewBefore","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":120,"src":"4199:10:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":">=","rightExpression":{"hexValue":"30","id":142,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"4213:1:0","typeDescriptions":{"typeIdentifier":"t_rational_0_by_1","typeString":"int_const 0"},"value":"0"},"src":"4199:15:0","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"falseExpression":{"id":146,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"UnaryOperation","operator":"-","prefix":true,"src":"4230:11:0","subExpression":{"id":145,"name":"skewBefore","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":120,"src":"4231:10:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"id":147,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"Conditional","src":"4199:42:0","trueExpression":{"id":144,"name":"skewBefore","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":120,"src":"4217:10:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"VariableDeclarationStatement","src":"4176:65:0"},{"assignments":[150],"declarations":[{"constant":false,"id":150,"mutability":"mutable","name":"absSkewAfter","nameLocation":"4262:12:0","nodeType":"VariableDeclaration","scope":165,"src":"4255:19:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"},"typeName":{"id":149,"name":"int256","nodeType":"ElementaryTypeName","src":"4255:6:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"visibility":"internal"}],"id":158,"initialValue":{"condition":{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":153,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":151,"name":"skewAfter","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":128,"src":"4277:9:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":">=","rightExpression":{"hexValue":"30","id":152,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"4290:1:0","typeDescriptions":{"typeIdentifier":"t_rational_0_by_1","typeString":"int_const 0"},"value":"0"},"src":"4277:14:0","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"falseExpression":{"id":156,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"UnaryOperation","operator":"-","prefix":true,"src":"4306:10:0","subExpression":{"id":155,"name":"skewAfter","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":128,"src":"4307:9:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"id":157,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"Conditional","src":"4277:39:0","trueExpression":{"id":154,"name":"skewAfter","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":128,"src":"4294:9:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"VariableDeclarationStatement","src":"4255:61:0"},{"expression":{"id":163,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"id":159,"name":"skew","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":24,"src":"4330:4:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"Assignment","operator":"=","rightHandSide":{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":162,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":160,"name":"absSkewAfter","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":150,"src":"4337:12:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":"-","rightExpression":{"id":161,"name":"absSkewBefore","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":140,"src":"4352:13:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"src":"4337:28:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"src":"4330:35:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"id":164,"nodeType":"ExpressionStatement","src":"4330:35:0"}]}},{"condition":{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":176,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":174,"name":"skew","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":24,"src":"4526:4:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":">","rightExpression":{"hexValue":"316539","id":175,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"4533:3:0","typeDescriptions":{"typeIdentifier":"t_rational_1000000000_by_1","typeString":"int_const 1000000000"},"value":"1e9"},"src":"4526:10:0","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"id":179,"nodeType":"IfStatement","src":"4522:26:0","trueBody":{"expression":{"hexValue":"316539","id":177,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"4545:3:0","typeDescriptions":{"typeIdentifier":"t_rational_1000000000_by_1","typeString":"int_const 1000000000"},"value":"1e9"},"functionReturnParameters":25,"id":178,"nodeType":"Return","src":"4538:10:0"}},{"condition":{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":183,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":180,"name":"skew","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":24,"src":"4562:4:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":"<","rightExpression":{"id":182,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"UnaryOperation","operator":"-","prefix":true,"src":"4569:4:0","subExpression":{"hexValue":"316539","id":181,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"4570:3:0","typeDescriptions":{"typeIdentifier":"t_rational_1000000000_by_1","typeString":"int_const 1000000000"},"value":"1e9"},"typeDescriptions":{"typeIdentifier":"t_rational_minus_1000000000_by_1","typeString":"int_const -1000000000"}},"src":"4562:11:0","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"id":187,"nodeType":"IfStatement","src":"4558:28:0","trueBody":{"expression":{"id":185,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"UnaryOperation","operator":"-","prefix":true,"src":"4582:4:0","subExpression":{"hexValue":"316539","id":184,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"4583:3:0","typeDescriptions":{"typeIdentifier":"t_rational_1000000000_by_1","typeString":"int_const 1000000000"},"value":"1e9"},"typeDescriptions":{"typeIdentifier":"t_rational_minus_1000000000_by_1","typeString":"int_const -1000000000"}},"functionReturnParameters":25,"id":186,"nodeType":"Return","src":"4575:11:0"}},{"expression":{"id":188,"name":"skew","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":24,"src":"4603:4:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"functionReturnParameters":25,"id":189,"nodeType":"Return","src":"4596:11:0"}]},"documentation":{"id":8,"nodeType":"StructuredDocumentation","src":"722:1427:0","text":"@notice Calculate inventory skew based on value-weighted inventory deviation from target\n @dev Computes skew as the change in inventory imbalance due to the trade:\n      \n      Logic:\n      1. Convert both inventories to common value (asset0 terms) using midPrice\n      2. Calculate skew before trade based on risky asset mode\n      3. Calculate skew after trade (simulate trade effect)\n      4. For RISKY0/RISKY1: skew = skew_after - skew_before\n      5. For NEUTRAL: skew = abs(skew_before) - abs(skew_after) (improvement metric)\n      \n      Skew formulas by mode:\n      - NEUTRAL: skew = (value0 / [(value0 + value1)/2]) - 1\n      - RISKY0: skew = value0 / (value0 + value1)\n      - RISKY1: skew = value1 / (value0 + value1)\n      \n      where values are in asset0 terms: value0 = inv0, value1 = inv1 * midPrice\n @param inventory0Raw Current inventory of asset0\n @param inventory1Raw Current inventory of asset1\n @param amount Trade amount in input asset units\n @param zeroForOne Trade direction (true = asset0→asset1, false = asset1→asset0)\n @param riskyMode Determines which asset is considered risky\n @param midPricePpb Mid price (asset0/asset1) in PPB - how many asset1 per asset0\n @return skew Trade-induced skew change in range [-1e9, +1e9] in PPB"},"id":191,"implemented":true,"kind":"function","modifiers":[],"name":"calculateSkew","nameLocation":"2163:13:0","nodeType":"FunctionDefinition","parameters":{"id":22,"nodeType":"ParameterList","parameters":[{"constant":false,"id":10,"mutability":"mutable","name":"inventory0Raw","nameLocation":"2194:13:0","nodeType":"VariableDeclaration","scope":191,"src":"2186:21:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":9,"name":"uint256","nodeType":"ElementaryTypeName","src":"2186:7:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"},{"constant":false,"id":12,"mutability":"mutable","name":"inventory1Raw","nameLocation":"2225:13:0","nodeType":"VariableDeclaration","scope":191,"src":"2217:21:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":11,"name":"uint256","nodeType":"ElementaryTypeName","src":"2217:7:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"},{"constant":false,"id":14,"mutability":"mutable","name":"amount","nameLocation":"2256:6:0","nodeType":"VariableDeclaration","scope":191,"src":"2248:14:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":13,"name":"uint256","nodeType":"ElementaryTypeName","src":"2248:7:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"},{"constant":false,"id":16,"mutability":"mutable","name":"zeroForOne","nameLocation":"2277:10:0","nodeType":"VariableDeclaration","scope":191,"src":"2272:15:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"},"typeName":{"id":15,"name":"bool","nodeType":"ElementaryTypeName","src":"2272:4:0","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"visibility":"internal"},{"constant":false,"id":19,"mutability":"mutable","name":"riskyMode","nameLocation":"2312:9:0","nodeType":"VariableDeclaration","scope":191,"src":"2297:24:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"},"typeName":{"id":18,"nodeType":"UserDefinedTypeName","pathNode":{"id":17,"name":"RiskyAssetMode","nameLocations":["2297:14:0"],"nodeType":"IdentifierPath","referencedDeclaration":7,"src":"2297:14:0"},"referencedDeclaration":7,"src":"2297:14:0","typeDescriptions":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"}},"visibility":"internal"},{"constant":false,"id":21,"mutability":"mutable","name":"midPricePpb","nameLocation":"2339:11:0","nodeType":"VariableDeclaration","scope":191,"src":"2331:19:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":20,"name":"uint256","nodeType":"ElementaryTypeName","src":"2331:7:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"}],"src":"2176:180:0"},"returnParameters":{"id":25,"nodeType":"ParameterList","parameters":[{"constant":false,"id":24,"mutability":"mutable","name":"skew","nameLocation":"2387:4:0","nodeType":"VariableDeclaration","scope":191,"src":"2380:11:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"},"typeName":{"id":23,"name":"int256","nodeType":"ElementaryTypeName","src":"2380:6:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"visibility":"internal"}],"src":"2379:13:0"},"scope":356,"src":"2154:2460:0","stateMutability":"pure","virtual":false,"visibility":"internal"},{"body":{"id":276,"nodeType":"Block","src":"4892:758:0","statements":[{"assignments":[205],"declarations":[{"constant":false,"id":205,"mutability":"mutable","name":"totalValue","nameLocation":"4910:10:0","nodeType":"VariableDeclaration","scope":276,"src":"4902:18:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":204,"name":"uint256","nodeType":"ElementaryTypeName","src":"4902:7:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"}],"id":209,"initialValue":{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":208,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":206,"name":"value0","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":194,"src":"4923:6:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"+","rightExpression":{"id":207,"name":"value1","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":196,"src":"4932:6:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"4923:15:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"VariableDeclarationStatement","src":"4902:36:0"},{"condition":{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":212,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":210,"name":"totalValue","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":205,"src":"4952:10:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"==","rightExpression":{"hexValue":"30","id":211,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"4966:1:0","typeDescriptions":{"typeIdentifier":"t_rational_0_by_1","typeString":"int_const 0"},"value":"0"},"src":"4952:15:0","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"id":215,"nodeType":"IfStatement","src":"4948:29:0","trueBody":{"expression":{"hexValue":"30","id":213,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"4976:1:0","typeDescriptions":{"typeIdentifier":"t_rational_0_by_1","typeString":"int_const 0"},"value":"0"},"functionReturnParameters":203,"id":214,"nodeType":"Return","src":"4969:8:0"}},{"condition":{"commonType":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"},"id":219,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":216,"name":"riskyMode","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":199,"src":"5000:9:0","typeDescriptions":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"}},"nodeType":"BinaryOperation","operator":"==","rightExpression":{"expression":{"id":217,"name":"RiskyAssetMode","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":7,"src":"5013:14:0","typeDescriptions":{"typeIdentifier":"t_type$_t_enum$_RiskyAssetMode_$7_$","typeString":"type(enum InventorySkew.RiskyAssetMode)"}},"id":218,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"memberLocation":"5028:7:0","memberName":"NEUTRAL","nodeType":"MemberAccess","referencedDeclaration":4,"src":"5013:22:0","typeDescriptions":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"}},"src":"5000:35:0","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"falseBody":{"condition":{"commonType":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"},"id":245,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":242,"name":"riskyMode","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":199,"src":"5315:9:0","typeDescriptions":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"}},"nodeType":"BinaryOperation","operator":"==","rightExpression":{"expression":{"id":243,"name":"RiskyAssetMode","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":7,"src":"5328:14:0","typeDescriptions":{"typeIdentifier":"t_type$_t_enum$_RiskyAssetMode_$7_$","typeString":"type(enum InventorySkew.RiskyAssetMode)"}},"id":244,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"memberLocation":"5343:6:0","memberName":"RISKY0","nodeType":"MemberAccess","referencedDeclaration":5,"src":"5328:21:0","typeDescriptions":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"}},"src":"5315:34:0","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"falseBody":{"id":273,"nodeType":"Block","src":"5502:142:0","statements":[{"expression":{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":271,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"components":[{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":265,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"arguments":[{"id":262,"name":"value1","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":196,"src":"5598:6:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint256","typeString":"uint256"}],"id":261,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"5591:6:0","typeDescriptions":{"typeIdentifier":"t_type$_t_int256_$","typeString":"type(int256)"},"typeName":{"id":260,"name":"int256","nodeType":"ElementaryTypeName","src":"5591:6:0","typeDescriptions":{}}},"id":263,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"5591:14:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":"*","rightExpression":{"hexValue":"316539","id":264,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"5608:3:0","typeDescriptions":{"typeIdentifier":"t_rational_1000000000_by_1","typeString":"int_const 1000000000"},"value":"1e9"},"src":"5591:20:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}}],"id":266,"isConstant":false,"isInlineArray":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"TupleExpression","src":"5590:22:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":"/","rightExpression":{"arguments":[{"id":269,"name":"totalValue","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":205,"src":"5622:10:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint256","typeString":"uint256"}],"id":268,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"5615:6:0","typeDescriptions":{"typeIdentifier":"t_type$_t_int256_$","typeString":"type(int256)"},"typeName":{"id":267,"name":"int256","nodeType":"ElementaryTypeName","src":"5615:6:0","typeDescriptions":{}}},"id":270,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"5615:18:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"src":"5590:43:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"functionReturnParameters":203,"id":272,"nodeType":"Return","src":"5583:50:0"}]},"id":274,"nodeType":"IfStatement","src":"5311:333:0","trueBody":{"id":259,"nodeType":"Block","src":"5351:145:0","statements":[{"expression":{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":257,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"components":[{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":251,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"arguments":[{"id":248,"name":"value0","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":194,"src":"5437:6:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint256","typeString":"uint256"}],"id":247,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"5430:6:0","typeDescriptions":{"typeIdentifier":"t_type$_t_int256_$","typeString":"type(int256)"},"typeName":{"id":246,"name":"int256","nodeType":"ElementaryTypeName","src":"5430:6:0","typeDescriptions":{}}},"id":249,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"5430:14:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":"*","rightExpression":{"hexValue":"316539","id":250,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"5447:3:0","typeDescriptions":{"typeIdentifier":"t_rational_1000000000_by_1","typeString":"int_const 1000000000"},"value":"1e9"},"src":"5430:20:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}}],"id":252,"isConstant":false,"isInlineArray":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"TupleExpression","src":"5429:22:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":"/","rightExpression":{"arguments":[{"id":255,"name":"totalValue","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":205,"src":"5461:10:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint256","typeString":"uint256"}],"id":254,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"5454:6:0","typeDescriptions":{"typeIdentifier":"t_type$_t_int256_$","typeString":"type(int256)"},"typeName":{"id":253,"name":"int256","nodeType":"ElementaryTypeName","src":"5454:6:0","typeDescriptions":{}}},"id":256,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"5454:18:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"src":"5429:43:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"functionReturnParameters":203,"id":258,"nodeType":"Return","src":"5422:50:0"}]}},"id":275,"nodeType":"IfStatement","src":"4996:648:0","trueBody":{"id":241,"nodeType":"Block","src":"5037:268:0","statements":[{"assignments":[221],"declarations":[{"constant":false,"id":221,"mutability":"mutable","name":"ratio","nameLocation":"5171:5:0","nodeType":"VariableDeclaration","scope":241,"src":"5164:12:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"},"typeName":{"id":220,"name":"int256","nodeType":"ElementaryTypeName","src":"5164:6:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"visibility":"internal"}],"id":236,"initialValue":{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":235,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"components":[{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":229,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":227,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"arguments":[{"id":224,"name":"value0","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":194,"src":"5187:6:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint256","typeString":"uint256"}],"id":223,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"5180:6:0","typeDescriptions":{"typeIdentifier":"t_type$_t_int256_$","typeString":"type(int256)"},"typeName":{"id":222,"name":"int256","nodeType":"ElementaryTypeName","src":"5180:6:0","typeDescriptions":{}}},"id":225,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"5180:14:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":"*","rightExpression":{"hexValue":"32","id":226,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"5197:1:0","typeDescriptions":{"typeIdentifier":"t_rational_2_by_1","typeString":"int_const 2"},"value":"2"},"src":"5180:18:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":"*","rightExpression":{"hexValue":"316539","id":228,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"5201:3:0","typeDescriptions":{"typeIdentifier":"t_rational_1000000000_by_1","typeString":"int_const 1000000000"},"value":"1e9"},"src":"5180:24:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}}],"id":230,"isConstant":false,"isInlineArray":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"TupleExpression","src":"5179:26:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":"/","rightExpression":{"arguments":[{"id":233,"name":"totalValue","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":205,"src":"5215:10:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint256","typeString":"uint256"}],"id":232,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"5208:6:0","typeDescriptions":{"typeIdentifier":"t_type$_t_int256_$","typeString":"type(int256)"},"typeName":{"id":231,"name":"int256","nodeType":"ElementaryTypeName","src":"5208:6:0","typeDescriptions":{}}},"id":234,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"5208:18:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"src":"5179:47:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"VariableDeclarationStatement","src":"5164:62:0"},{"expression":{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":239,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":237,"name":"ratio","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":221,"src":"5247:5:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":"-","rightExpression":{"hexValue":"316539","id":238,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"5255:3:0","typeDescriptions":{"typeIdentifier":"t_rational_1000000000_by_1","typeString":"int_const 1000000000"},"value":"1e9"},"src":"5247:11:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"functionReturnParameters":203,"id":240,"nodeType":"Return","src":"5240:18:0"}]}}]},"documentation":{"id":192,"nodeType":"StructuredDocumentation","src":"4620:110:0","text":"@notice Calculate skew at a given inventory state\n @dev Internal helper for before/after comparison"},"id":277,"implemented":true,"kind":"function","modifiers":[],"name":"_calculateSkewAtState","nameLocation":"4744:21:0","nodeType":"FunctionDefinition","parameters":{"id":200,"nodeType":"ParameterList","parameters":[{"constant":false,"id":194,"mutability":"mutable","name":"value0","nameLocation":"4783:6:0","nodeType":"VariableDeclaration","scope":277,"src":"4775:14:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":193,"name":"uint256","nodeType":"ElementaryTypeName","src":"4775:7:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"},{"constant":false,"id":196,"mutability":"mutable","name":"value1","nameLocation":"4807:6:0","nodeType":"VariableDeclaration","scope":277,"src":"4799:14:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":195,"name":"uint256","nodeType":"ElementaryTypeName","src":"4799:7:0","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"},{"constant":false,"id":199,"mutability":"mutable","name":"riskyMode","nameLocation":"4838:9:0","nodeType":"VariableDeclaration","scope":277,"src":"4823:24:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"},"typeName":{"id":198,"nodeType":"UserDefinedTypeName","pathNode":{"id":197,"name":"RiskyAssetMode","nameLocations":["4823:14:0"],"nodeType":"IdentifierPath","referencedDeclaration":7,"src":"4823:14:0"},"referencedDeclaration":7,"src":"4823:14:0","typeDescriptions":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"}},"visibility":"internal"}],"src":"4765:88:0"},"returnParameters":{"id":203,"nodeType":"ParameterList","parameters":[{"constant":false,"id":202,"mutability":"mutable","name":"skewPpb","nameLocation":"4883:7:0","nodeType":"VariableDeclaration","scope":277,"src":"4876:14:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"},"typeName":{"id":201,"name":"int256","nodeType":"ElementaryTypeName","src":"4876:6:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"visibility":"internal"}],"src":"4875:16:0"},"scope":356,"src":"4735:915:0","stateMutability":"pure","virtual":false,"visibility":"private"},{"body":{"id":354,"nodeType":"Block","src":"6727:873:0","statements":[{"assignments":[294],"declarations":[{"constant":false,"id":294,"mutability":"mutable","name":"inventoryAdjustmentPpb","nameLocation":"7085:22:0","nodeType":"VariableDeclaration","scope":354,"src":"7078:29:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"},"typeName":{"id":293,"name":"int256","nodeType":"ElementaryTypeName","src":"7078:6:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"visibility":"internal"}],"id":307,"initialValue":{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":306,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"components":[{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":303,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":295,"name":"skewPpb","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":286,"src":"7111:7:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":"*","rightExpression":{"arguments":[{"arguments":[{"id":300,"name":"gammaStDev2Ppb","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":288,"src":"7136:14:0","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint32","typeString":"uint32"}],"id":299,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"7128:7:0","typeDescriptions":{"typeIdentifier":"t_type$_t_uint256_$","typeString":"type(uint256)"},"typeName":{"id":298,"name":"uint256","nodeType":"ElementaryTypeName","src":"7128:7:0","typeDescriptions":{}}},"id":301,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"7128:23:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint256","typeString":"uint256"}],"id":297,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"7121:6:0","typeDescriptions":{"typeIdentifier":"t_type$_t_int256_$","typeString":"type(int256)"},"typeName":{"id":296,"name":"int256","nodeType":"ElementaryTypeName","src":"7121:6:0","typeDescriptions":{}}},"id":302,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"7121:31:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"src":"7111:41:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}}],"id":304,"isConstant":false,"isInlineArray":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"TupleExpression","src":"7110:43:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":"/","rightExpression":{"hexValue":"31653133","id":305,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"7156:4:0","typeDescriptions":{"typeIdentifier":"t_rational_10000000000000_by_1","typeString":"int_const 10000000000000"},"value":"1e13"},"src":"7110:50:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"VariableDeclarationStatement","src":"7078:82:0"},{"assignments":[309],"declarations":[{"constant":false,"id":309,"mutability":"mutable","name":"baseSpread","nameLocation":"7253:10:0","nodeType":"VariableDeclaration","scope":354,"src":"7246:17:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"},"typeName":{"id":308,"name":"int256","nodeType":"ElementaryTypeName","src":"7246:6:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"visibility":"internal"}],"id":333,"initialValue":{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":332,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":324,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"arguments":[{"arguments":[{"id":314,"name":"invKPpb","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":280,"src":"7281:7:0","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint32","typeString":"uint32"}],"id":313,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"7273:7:0","typeDescriptions":{"typeIdentifier":"t_type$_t_uint256_$","typeString":"type(uint256)"},"typeName":{"id":312,"name":"uint256","nodeType":"ElementaryTypeName","src":"7273:7:0","typeDescriptions":{}}},"id":315,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"7273:16:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint256","typeString":"uint256"}],"id":311,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"7266:6:0","typeDescriptions":{"typeIdentifier":"t_type$_t_int256_$","typeString":"type(int256)"},"typeName":{"id":310,"name":"int256","nodeType":"ElementaryTypeName","src":"7266:6:0","typeDescriptions":{}}},"id":316,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"7266:24:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":"-","rightExpression":{"arguments":[{"arguments":[{"id":321,"name":"term2Ppb","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":282,"src":"7308:8:0","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint32","typeString":"uint32"}],"id":320,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"7300:7:0","typeDescriptions":{"typeIdentifier":"t_type$_t_uint256_$","typeString":"type(uint256)"},"typeName":{"id":319,"name":"uint256","nodeType":"ElementaryTypeName","src":"7300:7:0","typeDescriptions":{}}},"id":322,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"7300:17:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint256","typeString":"uint256"}],"id":318,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"7293:6:0","typeDescriptions":{"typeIdentifier":"t_type$_t_int256_$","typeString":"type(int256)"},"typeName":{"id":317,"name":"int256","nodeType":"ElementaryTypeName","src":"7293:6:0","typeDescriptions":{}}},"id":323,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"7293:25:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"src":"7266:52:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":"+","rightExpression":{"arguments":[{"arguments":[{"id":329,"name":"term3Ppb","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":284,"src":"7336:8:0","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint32","typeString":"uint32"}],"id":328,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"7328:7:0","typeDescriptions":{"typeIdentifier":"t_type$_t_uint256_$","typeString":"type(uint256)"},"typeName":{"id":327,"name":"uint256","nodeType":"ElementaryTypeName","src":"7328:7:0","typeDescriptions":{}}},"id":330,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"7328:17:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint256","typeString":"uint256"}],"id":326,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"7321:6:0","typeDescriptions":{"typeIdentifier":"t_type$_t_int256_$","typeString":"type(int256)"},"typeName":{"id":325,"name":"int256","nodeType":"ElementaryTypeName","src":"7321:6:0","typeDescriptions":{}}},"id":331,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"7321:25:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"src":"7266:80:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"VariableDeclarationStatement","src":"7246:100:0"},{"assignments":[335],"declarations":[{"constant":false,"id":335,"mutability":"mutable","name":"finalSpread","nameLocation":"7408:11:0","nodeType":"VariableDeclaration","scope":354,"src":"7401:18:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"},"typeName":{"id":334,"name":"int256","nodeType":"ElementaryTypeName","src":"7401:6:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"visibility":"internal"}],"id":339,"initialValue":{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":338,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":336,"name":"baseSpread","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":309,"src":"7422:10:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":"+","rightExpression":{"id":337,"name":"inventoryAdjustmentPpb","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":294,"src":"7435:22:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"src":"7422:35:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"VariableDeclarationStatement","src":"7401:56:0"},{"condition":{"commonType":{"typeIdentifier":"t_int256","typeString":"int256"},"id":342,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":340,"name":"finalSpread","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":335,"src":"7514:11:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"BinaryOperation","operator":"<","rightExpression":{"hexValue":"30","id":341,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"7528:1:0","typeDescriptions":{"typeIdentifier":"t_rational_0_by_1","typeString":"int_const 0"},"value":"0"},"src":"7514:15:0","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"id":345,"nodeType":"IfStatement","src":"7510:29:0","trueBody":{"expression":{"hexValue":"30","id":343,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"7538:1:0","typeDescriptions":{"typeIdentifier":"t_rational_0_by_1","typeString":"int_const 0"},"value":"0"},"functionReturnParameters":292,"id":344,"nodeType":"Return","src":"7531:8:0"}},{"expression":{"arguments":[{"arguments":[{"id":350,"name":"finalSpread","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":335,"src":"7580:11:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_int256","typeString":"int256"}],"id":349,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"7572:7:0","typeDescriptions":{"typeIdentifier":"t_type$_t_uint256_$","typeString":"type(uint256)"},"typeName":{"id":348,"name":"uint256","nodeType":"ElementaryTypeName","src":"7572:7:0","typeDescriptions":{}}},"id":351,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"7572:20:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint256","typeString":"uint256"}],"id":347,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"7565:6:0","typeDescriptions":{"typeIdentifier":"t_type$_t_uint32_$","typeString":"type(uint32)"},"typeName":{"id":346,"name":"uint32","nodeType":"ElementaryTypeName","src":"7565:6:0","typeDescriptions":{}}},"id":352,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"7565:28:0","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}},"functionReturnParameters":292,"id":353,"nodeType":"Return","src":"7558:35:0"}]},"documentation":{"id":278,"nodeType":"StructuredDocumentation","src":"5656:844:0","text":"@notice Calculate half-spread with inventory adjustment, ensuring non-negative result\n @dev Implements the full A-S spread formula with safety constraint:\n      Half_Spread = max(0, 1/k - gam/(2*k²) + (gam*σ²)/2 + q*gam*σ²)\n      \n      The last term (q*gam*σ²) can be negative for beneficial trades, potentially\n      making the spread negative. We enforce Half_Spread >= 0 to prevent invalid quotes.\n @param invKPpb The 1/k term in PPB (base spread)\n @param term2Ppb The gam/(2*k²) term in PPB  \n @param term3Ppb The (gam*σ²)/2 term in PPB\n @param skewPpb The inventory skew in range [-1e9, +1e9]\n @param gammaStDev2Ppb The gam*σ² product in PPB (for inventory adjustment)\n @return halfSpreadPpb The final half-spread in PPB, guaranteed >= 0"},"id":355,"implemented":true,"kind":"function","modifiers":[],"name":"calculateHalfSpreadWithInventory","nameLocation":"6514:32:0","nodeType":"FunctionDefinition","parameters":{"id":289,"nodeType":"ParameterList","parameters":[{"constant":false,"id":280,"mutability":"mutable","name":"invKPpb","nameLocation":"6563:7:0","nodeType":"VariableDeclaration","scope":355,"src":"6556:14:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"},"typeName":{"id":279,"name":"uint32","nodeType":"ElementaryTypeName","src":"6556:6:0","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}},"visibility":"internal"},{"constant":false,"id":282,"mutability":"mutable","name":"term2Ppb","nameLocation":"6587:8:0","nodeType":"VariableDeclaration","scope":355,"src":"6580:15:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"},"typeName":{"id":281,"name":"uint32","nodeType":"ElementaryTypeName","src":"6580:6:0","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}},"visibility":"internal"},{"constant":false,"id":284,"mutability":"mutable","name":"term3Ppb","nameLocation":"6612:8:0","nodeType":"VariableDeclaration","scope":355,"src":"6605:15:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"},"typeName":{"id":283,"name":"uint32","nodeType":"ElementaryTypeName","src":"6605:6:0","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}},"visibility":"internal"},{"constant":false,"id":286,"mutability":"mutable","name":"skewPpb","nameLocation":"6637:7:0","nodeType":"VariableDeclaration","scope":355,"src":"6630:14:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"},"typeName":{"id":285,"name":"int256","nodeType":"ElementaryTypeName","src":"6630:6:0","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"visibility":"internal"},{"constant":false,"id":288,"mutability":"mutable","name":"gammaStDev2Ppb","nameLocation":"6661:14:0","nodeType":"VariableDeclaration","scope":355,"src":"6654:21:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"},"typeName":{"id":287,"name":"uint32","nodeType":"ElementaryTypeName","src":"6654:6:0","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}},"visibility":"internal"}],"src":"6546:135:0"},"returnParameters":{"id":292,"nodeType":"ParameterList","parameters":[{"constant":false,"id":291,"mutability":"mutable","name":"halfSpreadPpb","nameLocation":"6712:13:0","nodeType":"VariableDeclaration","scope":355,"src":"6705:20:0","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"},"typeName":{"id":290,"name":"uint32","nodeType":"ElementaryTypeName","src":"6705:6:0","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}},"visibility":"internal"}],"src":"6704:22:0"},"scope":356,"src":"6505:1095:0","stateMutability":"pure","virtual":false,"visibility":"internal"}],"scope":357,"src":"324:7279:0","usedErrors":[],"usedEvents":[]}],"src":"32:7573:0"},"id":0},"contracts/Peripheral/libraries/tests/InventorySkewTest.sol":{"ast":{"absolutePath":"contracts/Peripheral/libraries/tests/InventorySkewTest.sol","exportedSymbols":{"InventorySkew":[356],"InventorySkewTest":[424]},"id":425,"license":"MIT","nodeType":"SourceUnit","nodes":[{"id":358,"literals":["solidity","^","0.8",".30"],"nodeType":"PragmaDirective","src":"32:24:1"},{"absolutePath":"contracts/Peripheral/libraries/InventorySkew.sol","file":"../InventorySkew.sol","id":359,"nameLocation":"-1:-1:-1","nodeType":"ImportDirective","scope":425,"sourceUnit":357,"src":"58:30:1","symbolAliases":[],"unitAlias":""},{"abstract":false,"baseContracts":[],"canonicalName":"InventorySkewTest","contractDependencies":[],"contractKind":"contract","documentation":{"id":360,"nodeType":"StructuredDocumentation","src":"90:80:1","text":"@title InventorySkewTest\n @notice Test harness for InventorySkew library"},"fullyImplemented":true,"id":424,"linearizedBaseContracts":[424],"name":"InventorySkewTest","nameLocation":"179:17:1","nodeType":"ContractDefinition","nodes":[{"body":{"id":397,"nodeType":"Block","src":"432:301:1","statements":[{"assignments":[381],"declarations":[{"constant":false,"id":381,"mutability":"mutable","name":"riskyMode","nameLocation":"471:9:1","nodeType":"VariableDeclaration","scope":397,"src":"442:38:1","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"},"typeName":{"id":380,"nodeType":"UserDefinedTypeName","pathNode":{"id":379,"name":"InventorySkew.RiskyAssetMode","nameLocations":["442:13:1","456:14:1"],"nodeType":"IdentifierPath","referencedDeclaration":7,"src":"442:28:1"},"referencedDeclaration":7,"src":"442:28:1","typeDescriptions":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"}},"visibility":"internal"}],"id":386,"initialValue":{"arguments":[{"id":384,"name":"riskyModeUint","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":370,"src":"512:13:1","typeDescriptions":{"typeIdentifier":"t_uint8","typeString":"uint8"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint8","typeString":"uint8"}],"expression":{"id":382,"name":"InventorySkew","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":356,"src":"483:13:1","typeDescriptions":{"typeIdentifier":"t_type$_t_contract$_InventorySkew_$356_$","typeString":"type(library InventorySkew)"}},"id":383,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberLocation":"497:14:1","memberName":"RiskyAssetMode","nodeType":"MemberAccess","referencedDeclaration":7,"src":"483:28:1","typeDescriptions":{"typeIdentifier":"t_type$_t_enum$_RiskyAssetMode_$7_$","typeString":"type(enum InventorySkew.RiskyAssetMode)"}},"id":385,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"483:43:1","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"}},"nodeType":"VariableDeclarationStatement","src":"442:84:1"},{"expression":{"arguments":[{"id":389,"name":"inventory0Raw","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":362,"src":"584:13:1","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},{"id":390,"name":"inventory1Raw","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":364,"src":"611:13:1","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},{"id":391,"name":"amount","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":366,"src":"638:6:1","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},{"id":392,"name":"zeroForOne","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":368,"src":"658:10:1","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},{"id":393,"name":"riskyMode","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":381,"src":"682:9:1","typeDescriptions":{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"}},{"id":394,"name":"midPricePpb","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":372,"src":"705:11:1","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint256","typeString":"uint256"},{"typeIdentifier":"t_uint256","typeString":"uint256"},{"typeIdentifier":"t_uint256","typeString":"uint256"},{"typeIdentifier":"t_bool","typeString":"bool"},{"typeIdentifier":"t_enum$_RiskyAssetMode_$7","typeString":"enum InventorySkew.RiskyAssetMode"},{"typeIdentifier":"t_uint256","typeString":"uint256"}],"expression":{"id":387,"name":"InventorySkew","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":356,"src":"543:13:1","typeDescriptions":{"typeIdentifier":"t_type$_t_contract$_InventorySkew_$356_$","typeString":"type(library InventorySkew)"}},"id":388,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberLocation":"557:13:1","memberName":"calculateSkew","nodeType":"MemberAccess","referencedDeclaration":191,"src":"543:27:1","typeDescriptions":{"typeIdentifier":"t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_bool_$_t_enum$_RiskyAssetMode_$7_$_t_uint256_$returns$_t_int256_$","typeString":"function (uint256,uint256,uint256,bool,enum InventorySkew.RiskyAssetMode,uint256) pure returns (int256)"}},"id":395,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"543:183:1","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"functionReturnParameters":376,"id":396,"nodeType":"Return","src":"536:190:1"}]},"functionSelector":"8acc7b7a","id":398,"implemented":true,"kind":"function","modifiers":[],"name":"calculateSkew","nameLocation":"212:13:1","nodeType":"FunctionDefinition","parameters":{"id":373,"nodeType":"ParameterList","parameters":[{"constant":false,"id":362,"mutability":"mutable","name":"inventory0Raw","nameLocation":"243:13:1","nodeType":"VariableDeclaration","scope":398,"src":"235:21:1","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":361,"name":"uint256","nodeType":"ElementaryTypeName","src":"235:7:1","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"},{"constant":false,"id":364,"mutability":"mutable","name":"inventory1Raw","nameLocation":"274:13:1","nodeType":"VariableDeclaration","scope":398,"src":"266:21:1","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":363,"name":"uint256","nodeType":"ElementaryTypeName","src":"266:7:1","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"},{"constant":false,"id":366,"mutability":"mutable","name":"amount","nameLocation":"305:6:1","nodeType":"VariableDeclaration","scope":398,"src":"297:14:1","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":365,"name":"uint256","nodeType":"ElementaryTypeName","src":"297:7:1","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"},{"constant":false,"id":368,"mutability":"mutable","name":"zeroForOne","nameLocation":"326:10:1","nodeType":"VariableDeclaration","scope":398,"src":"321:15:1","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"},"typeName":{"id":367,"name":"bool","nodeType":"ElementaryTypeName","src":"321:4:1","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"visibility":"internal"},{"constant":false,"id":370,"mutability":"mutable","name":"riskyModeUint","nameLocation":"352:13:1","nodeType":"VariableDeclaration","scope":398,"src":"346:19:1","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint8","typeString":"uint8"},"typeName":{"id":369,"name":"uint8","nodeType":"ElementaryTypeName","src":"346:5:1","typeDescriptions":{"typeIdentifier":"t_uint8","typeString":"uint8"}},"visibility":"internal"},{"constant":false,"id":372,"mutability":"mutable","name":"midPricePpb","nameLocation":"383:11:1","nodeType":"VariableDeclaration","scope":398,"src":"375:19:1","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":371,"name":"uint256","nodeType":"ElementaryTypeName","src":"375:7:1","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"}],"src":"225:175:1"},"returnParameters":{"id":376,"nodeType":"ParameterList","parameters":[{"constant":false,"id":375,"mutability":"mutable","name":"","nameLocation":"-1:-1:-1","nodeType":"VariableDeclaration","scope":398,"src":"424:6:1","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"},"typeName":{"id":374,"name":"int256","nodeType":"ElementaryTypeName","src":"424:6:1","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"visibility":"internal"}],"src":"423:8:1"},"scope":424,"src":"203:530:1","stateMutability":"pure","virtual":false,"visibility":"external"},{"body":{"id":422,"nodeType":"Block","src":"947:194:1","statements":[{"expression":{"arguments":[{"id":415,"name":"invKPpb","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":400,"src":"1024:7:1","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}},{"id":416,"name":"term2Ppb","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":402,"src":"1045:8:1","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}},{"id":417,"name":"term3Ppb","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":404,"src":"1067:8:1","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}},{"id":418,"name":"skewPpb","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":406,"src":"1089:7:1","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},{"id":419,"name":"gammaStDev2Ppb","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":408,"src":"1110:14:1","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint32","typeString":"uint32"},{"typeIdentifier":"t_uint32","typeString":"uint32"},{"typeIdentifier":"t_uint32","typeString":"uint32"},{"typeIdentifier":"t_int256","typeString":"int256"},{"typeIdentifier":"t_uint32","typeString":"uint32"}],"expression":{"id":413,"name":"InventorySkew","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":356,"src":"964:13:1","typeDescriptions":{"typeIdentifier":"t_type$_t_contract$_InventorySkew_$356_$","typeString":"type(library InventorySkew)"}},"id":414,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberLocation":"978:32:1","memberName":"calculateHalfSpreadWithInventory","nodeType":"MemberAccess","referencedDeclaration":355,"src":"964:46:1","typeDescriptions":{"typeIdentifier":"t_function_internal_pure$_t_uint32_$_t_uint32_$_t_uint32_$_t_int256_$_t_uint32_$returns$_t_uint32_$","typeString":"function (uint32,uint32,uint32,int256,uint32) pure returns (uint32)"}},"id":420,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"nameLocations":[],"names":[],"nodeType":"FunctionCall","src":"964:170:1","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}},"functionReturnParameters":412,"id":421,"nodeType":"Return","src":"957:177:1"}]},"functionSelector":"1abf44c9","id":423,"implemented":true,"kind":"function","modifiers":[],"name":"calculateHalfSpreadWithInventory","nameLocation":"748:32:1","nodeType":"FunctionDefinition","parameters":{"id":409,"nodeType":"ParameterList","parameters":[{"constant":false,"id":400,"mutability":"mutable","name":"invKPpb","nameLocation":"797:7:1","nodeType":"VariableDeclaration","scope":423,"src":"790:14:1","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"},"typeName":{"id":399,"name":"uint32","nodeType":"ElementaryTypeName","src":"790:6:1","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}},"visibility":"internal"},{"constant":false,"id":402,"mutability":"mutable","name":"term2Ppb","nameLocation":"821:8:1","nodeType":"VariableDeclaration","scope":423,"src":"814:15:1","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"},"typeName":{"id":401,"name":"uint32","nodeType":"ElementaryTypeName","src":"814:6:1","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}},"visibility":"internal"},{"constant":false,"id":404,"mutability":"mutable","name":"term3Ppb","nameLocation":"846:8:1","nodeType":"VariableDeclaration","scope":423,"src":"839:15:1","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"},"typeName":{"id":403,"name":"uint32","nodeType":"ElementaryTypeName","src":"839:6:1","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}},"visibility":"internal"},{"constant":false,"id":406,"mutability":"mutable","name":"skewPpb","nameLocation":"871:7:1","nodeType":"VariableDeclaration","scope":423,"src":"864:14:1","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"},"typeName":{"id":405,"name":"int256","nodeType":"ElementaryTypeName","src":"864:6:1","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"visibility":"internal"},{"constant":false,"id":408,"mutability":"mutable","name":"gammaStDev2Ppb","nameLocation":"895:14:1","nodeType":"VariableDeclaration","scope":423,"src":"888:21:1","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"},"typeName":{"id":407,"name":"uint32","nodeType":"ElementaryTypeName","src":"888:6:1","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}},"visibility":"internal"}],"src":"780:135:1"},"returnParameters":{"id":412,"nodeType":"ParameterList","parameters":[{"constant":false,"id":411,"mutability":"mutable","name":"","nameLocation":"-1:-1:-1","nodeType":"VariableDeclaration","scope":423,"src":"939:6:1","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"},"typeName":{"id":410,"name":"uint32","nodeType":"ElementaryTypeName","src":"939:6:1","typeDescriptions":{"typeIdentifier":"t_uint32","typeString":"uint32"}},"visibility":"internal"}],"src":"938:8:1"},"scope":424,"src":"739:402:1","stateMutability":"pure","virtual":false,"visibility":"external"}],"scope":425,"src":"170:973:1","usedErrors":[],"usedEvents":[]}],"src":"32:1113:1"},"id":1}},"contracts":{"contracts/Peripheral/libraries/InventorySkew.sol":{"InventorySkew":{"abi":[],"evm":{"bytecode":{"functionDebugData":{},"generatedSources":[],"linkReferences":{},"object":"6080806040523460175760399081601c823930815050f35b5f80fdfe5f80fdfea26469706673582212209d3b5eed18afd71d4b6b896b2d97dd5834a5c38b1c51c0ea1b28bc4462dce6a364736f6c634300081e0033","opcodes":"PUSH1 0x80 DUP1 PUSH1 0x40 MSTORE CALLVALUE PUSH1 0x17 JUMPI PUSH1 0x39 SWAP1 DUP2 PUSH1 0x1C DUP3 CODECOPY ADDRESS DUP2 POP POP RETURN JUMPDEST PUSH0 DUP1 REVERT INVALID PUSH0 DUP1 REVERT INVALID LOG2 PUSH5 0x6970667358 0x22 SLT KECCAK256 SWAP14 EXTCODESIZE MCOPY 0xED XOR 0xAF 0xD7 SAR 0x4B PUSH12 0x896B2D97DD5834A5C38B1C51 0xC0 0xEA SHL 0x28 0xBC PREVRANDAO PUSH3 0xDCE6A3 PUSH5 0x736F6C6343 STOP ADDMOD 0x1E STOP CALLER ","sourceMap":"324:7279:0:-:0;;;;;;;;;;;;;;;;;;;;;"},"deployedBytecode":{"functionDebugData":{},"generatedSources":[],"immutableReferences":{},"linkReferences":{},"object":"5f80fdfea26469706673582212209d3b5eed18afd71d4b6b896b2d97dd5834a5c38b1c51c0ea1b28bc4462dce6a364736f6c634300081e0033","opcodes":"PUSH0 DUP1 REVERT INVALID LOG2 PUSH5 0x6970667358 0x22 SLT KECCAK256 SWAP14 EXTCODESIZE MCOPY 0xED XOR 0xAF 0xD7 SAR 0x4B PUSH12 0x896B2D97DD5834A5C38B1C51 0xC0 0xEA SHL 0x28 0xBC PREVRANDAO PUSH3 0xDCE6A3 PUSH5 0x736F6C6343 STOP ADDMOD 0x1E STOP CALLER ","sourceMap":"324:7279:0:-:0;;"},"methodIdentifiers":{}},"metadata":"{\"compiler\":{\"version\":\"0.8.30+commit.73712a01\"},\"language\":\"Solidity\",\"output\":{\"abi\":[],\"devdoc\":{\"details\":\"Implements inventory skew calculation that produces values in range [-1, +1]      representing LP's deviation from desired inventory position\",\"kind\":\"dev\",\"methods\":{},\"title\":\"InventorySkew\",\"version\":1},\"userdoc\":{\"kind\":\"user\",\"methods\":{},\"notice\":\"Calculates normalized inventory skew for Avellaneda-Stoikov market making\",\"version\":1}},\"settings\":{\"compilationTarget\":{\"contracts/Peripheral/libraries/InventorySkew.sol\":\"InventorySkew\"},\"evmVersion\":\"cancun\",\"libraries\":{},\"metadata\":{\"bytecodeHash\":\"ipfs\"},\"optimizer\":{\"enabled\":true,\"runs\":200},\"remappings\":[],\"viaIR\":true},\"sources\":{\"contracts/Peripheral/libraries/InventorySkew.sol\":{\"keccak256\":\"0x89305744ea99cc1e876ead3eb537cb095cca6d99d7e83021ec332790d4487d91\",\"license\":\"MIT\",\"urls\":[\"bzz-raw://78308b0e2c56c4c83154e8f215e131199772401a081c167473b283767cbca601\",\"dweb:/ipfs/QmSAknhrdfLgBvaHzXGzK5wMT5eHx4FQa3um9YM2XNnPsz\"]}},\"version\":1}"}},"contracts/Peripheral/libraries/tests/InventorySkewTest.sol":{"InventorySkewTest":{"abi":[{"inputs":[{"internalType":"uint32","name":"invKPpb","type":"uint32"},{"internalType":"uint32","name":"term2Ppb","type":"uint32"},{"internalType":"uint32","name":"term3Ppb","type":"uint32"},{"internalType":"int256","name":"skewPpb","type":"int256"},{"internalType":"uint32","name":"gammaStDev2Ppb","type":"uint32"}],"name":"calculateHalfSpreadWithInventory","outputs":[{"internalType":"uint32","name":"","type":"uint32"}],"stateMutability":"pure","type":"function"},{"inputs":[{"internalType":"uint256","name":"inventory0Raw","type":"uint256"},{"internalType":"uint256","name":"inventory1Raw","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"bool","name":"zeroForOne","type":"bool"},{"internalType":"uint8","name":"riskyModeUint","type":"uint8"},{"internalType":"uint256","name":"midPricePpb","type":"uint256"}],"name":"calculateSkew","outputs":[{"internalType":"int256","name":"","type":"int256"}],"stateMutability":"pure","type":"function"}],"evm":{"bytecode":{"functionDebugData":{},"generatedSources":[],"linkReferences":{},"object":"60808060405234601557610480908161001a8239f35b5f80fdfe60806040526004361015610011575f80fd5b5f3560e01c80631abf44c91461009c57638acc7b7a1461002f575f80fd5b346100985760c03660031901126100985760643580151581036100985760843560ff81168091036100985760038110156100845760209161007c9160a43591604435602435600435610243565b604051908152f35b634e487b7160e01b5f52602160045260245ffd5b5f80fd5b346100985760a03660031901126100985760043563ffffffff811681036100985760243563ffffffff81168103610098576044359163ffffffff83168303610098576084359063ffffffff82168203610098576020936100ff936064359261019e565b63ffffffff60405191168152f35b90633b9aca00820291808305633b9aca00149015171561012957565b634e487b7160e01b5f52601160045260245ffd5b811561015757600160ff1b81145f19831416610129570590565b634e487b7160e01b5f52601260045260245ffd5b81810392915f13801582851316918412161761012957565b9190915f838201938412911290801582169115161761012957565b93909263ffffffff9091168082029291905f8212600160ff1b8214166101295781840514901517156101295763ffffffff6101ed6101fa9582806509184e72a0006101f597059716911661016b565b911690610183565b610183565b5f811261020a5763ffffffff1690565b505f90565b8115610157570490565b9190820391821161012957565b9190820180921161012957565b600160ff1b8114610129575f0390565b909492919394633b9aca00810290808204633b9aca001490151715610129578361026c9161020f565b911561035f5783811115610359576102848482610219565b938381029080820485149015171561012957633b9aca00900492633b9aca00840293808504633b9aca001490151715610129578580936102d36102cd6102d3946102d99861020f565b82610226565b936103c1565b9160038110156100845761034b5761030191905f811261033c57905b5f811261032e5761016b565b633b9aca00811361032557633b9ac9ff19811261031b5790565b50633b9ac9ff1990565b50633b9aca0090565b61033790610233565b61016b565b61034590610233565b906102f5565b6103549161016b565b610301565b5f610284565b92633b9aca00819392930290808204633b9aca001490151715610129576102d3856102d9946103b46103ae8661039685988861020f565b808511156103ba576103a89085610219565b9661020f565b88610226565b966103c1565b505f6103a8565b91906103cd8184610226565b918215610442576003811015610084578061041d5750508160011b9180830560021490151715610129576104036104089261010d565b61013d565b633b9ac9ff1981019081136001166101295790565b60010361043457506104036104319261010d565b90565b61043192506104039061010d565b505050505f9056fea2646970667358221220696b635dd3174dc81fdc8ecd26a12a78971f6e35602316160d6cc5b49bcce4a364736f6c634300081e0033","opcodes":"PUSH1 0x80 DUP1 PUSH1 0x40 MSTORE CALLVALUE PUSH1 0x15 JUMPI PUSH2 0x480 SWAP1 DUP2 PUSH2 0x1A DUP3 CODECOPY RETURN JUMPDEST PUSH0 DUP1 REVERT INVALID PUSH1 0x80 PUSH1 0x40 MSTORE PUSH1 0x4 CALLDATASIZE LT ISZERO PUSH2 0x11 JUMPI PUSH0 DUP1 REVERT JUMPDEST PUSH0 CALLDATALOAD PUSH1 0xE0 SHR DUP1 PUSH4 0x1ABF44C9 EQ PUSH2 0x9C JUMPI PUSH4 0x8ACC7B7A EQ PUSH2 0x2F JUMPI PUSH0 DUP1 REVERT JUMPDEST CALLVALUE PUSH2 0x98 JUMPI PUSH1 0xC0 CALLDATASIZE PUSH1 0x3 NOT ADD SLT PUSH2 0x98 JUMPI PUSH1 0x64 CALLDATALOAD DUP1 ISZERO ISZERO DUP2 SUB PUSH2 0x98 JUMPI PUSH1 0x84 CALLDATALOAD PUSH1 0xFF DUP2 AND DUP1 SWAP2 SUB PUSH2 0x98 JUMPI PUSH1 0x3 DUP2 LT ISZERO PUSH2 0x84 JUMPI PUSH1 0x20 SWAP2 PUSH2 0x7C SWAP2 PUSH1 0xA4 CALLDATALOAD SWAP2 PUSH1 0x44 CALLDATALOAD PUSH1 0x24 CALLDATALOAD PUSH1 0x4 CALLDATALOAD PUSH2 0x243 JUMP JUMPDEST PUSH1 0x40 MLOAD SWAP1 DUP2 MSTORE RETURN JUMPDEST PUSH4 0x4E487B71 PUSH1 0xE0 SHL PUSH0 MSTORE PUSH1 0x21 PUSH1 0x4 MSTORE PUSH1 0x24 PUSH0 REVERT JUMPDEST PUSH0 DUP1 REVERT JUMPDEST CALLVALUE PUSH2 0x98 JUMPI PUSH1 0xA0 CALLDATASIZE PUSH1 0x3 NOT ADD SLT PUSH2 0x98 JUMPI PUSH1 0x4 CALLDATALOAD PUSH4 0xFFFFFFFF DUP2 AND DUP2 SUB PUSH2 0x98 JUMPI PUSH1 0x24 CALLDATALOAD PUSH4 0xFFFFFFFF DUP2 AND DUP2 SUB PUSH2 0x98 JUMPI PUSH1 0x44 CALLDATALOAD SWAP2 PUSH4 0xFFFFFFFF DUP4 AND DUP4 SUB PUSH2 0x98 JUMPI PUSH1 0x84 CALLDATALOAD SWAP1 PUSH4 0xFFFFFFFF DUP3 AND DUP3 SUB PUSH2 0x98 JUMPI PUSH1 0x20 SWAP4 PUSH2 0xFF SWAP4 PUSH1 0x64 CALLDATALOAD SWAP3 PUSH2 0x19E JUMP JUMPDEST PUSH4 0xFFFFFFFF PUSH1 0x40 MLOAD SWAP2 AND DUP2 MSTORE RETURN JUMPDEST SWAP1 PUSH4 0x3B9ACA00 DUP3 MUL SWAP2 DUP1 DUP4 SDIV PUSH4 0x3B9ACA00 EQ SWAP1 ISZERO OR ISZERO PUSH2 0x129 JUMPI JUMP JUMPDEST PUSH4 0x4E487B71 PUSH1 0xE0 SHL PUSH0 MSTORE PUSH1 0x11 PUSH1 0x4 MSTORE PUSH1 0x24 PUSH0 REVERT JUMPDEST DUP2 ISZERO PUSH2 0x157 JUMPI PUSH1 0x1 PUSH1 0xFF SHL DUP2 EQ PUSH0 NOT DUP4 EQ AND PUSH2 0x129 JUMPI SDIV SWAP1 JUMP JUMPDEST PUSH4 0x4E487B71 PUSH1 0xE0 SHL PUSH0 MSTORE PUSH1 0x12 PUSH1 0x4 MSTORE PUSH1 0x24 PUSH0 REVERT JUMPDEST DUP2 DUP2 SUB SWAP3 SWAP2 PUSH0 SGT DUP1 ISZERO DUP3 DUP6 SGT AND SWAP2 DUP5 SLT AND OR PUSH2 0x129 JUMPI JUMP JUMPDEST SWAP2 SWAP1 SWAP2 PUSH0 DUP4 DUP3 ADD SWAP4 DUP5 SLT SWAP2 SLT SWAP1 DUP1 ISZERO DUP3 AND SWAP2 ISZERO AND OR PUSH2 0x129 JUMPI JUMP JUMPDEST SWAP4 SWAP1 SWAP3 PUSH4 0xFFFFFFFF SWAP1 SWAP2 AND DUP1 DUP3 MUL SWAP3 SWAP2 SWAP1 PUSH0 DUP3 SLT PUSH1 0x1 PUSH1 0xFF SHL DUP3 EQ AND PUSH2 0x129 JUMPI DUP2 DUP5 SDIV EQ SWAP1 ISZERO OR ISZERO PUSH2 0x129 JUMPI PUSH4 0xFFFFFFFF PUSH2 0x1ED PUSH2 0x1FA SWAP6 DUP3 DUP1 PUSH6 0x9184E72A000 PUSH2 0x1F5 SWAP8 SDIV SWAP8 AND SWAP2 AND PUSH2 0x16B JUMP JUMPDEST SWAP2 AND SWAP1 PUSH2 0x183 JUMP JUMPDEST PUSH2 0x183 JUMP JUMPDEST PUSH0 DUP2 SLT PUSH2 0x20A JUMPI PUSH4 0xFFFFFFFF AND SWAP1 JUMP JUMPDEST POP PUSH0 SWAP1 JUMP JUMPDEST DUP2 ISZERO PUSH2 0x157 JUMPI DIV SWAP1 JUMP JUMPDEST SWAP2 SWAP1 DUP3 SUB SWAP2 DUP3 GT PUSH2 0x129 JUMPI JUMP JUMPDEST SWAP2 SWAP1 DUP3 ADD DUP1 SWAP3 GT PUSH2 0x129 JUMPI JUMP JUMPDEST PUSH1 0x1 PUSH1 0xFF SHL DUP2 EQ PUSH2 0x129 JUMPI PUSH0 SUB SWAP1 JUMP JUMPDEST SWAP1 SWAP5 SWAP3 SWAP2 SWAP4 SWAP5 PUSH4 0x3B9ACA00 DUP2 MUL SWAP1 DUP1 DUP3 DIV PUSH4 0x3B9ACA00 EQ SWAP1 ISZERO OR ISZERO PUSH2 0x129 JUMPI DUP4 PUSH2 0x26C SWAP2 PUSH2 0x20F JUMP JUMPDEST SWAP2 ISZERO PUSH2 0x35F JUMPI DUP4 DUP2 GT ISZERO PUSH2 0x359 JUMPI PUSH2 0x284 DUP5 DUP3 PUSH2 0x219 JUMP JUMPDEST SWAP4 DUP4 DUP2 MUL SWAP1 DUP1 DUP3 DIV DUP6 EQ SWAP1 ISZERO OR ISZERO PUSH2 0x129 JUMPI PUSH4 0x3B9ACA00 SWAP1 DIV SWAP3 PUSH4 0x3B9ACA00 DUP5 MUL SWAP4 DUP1 DUP6 DIV PUSH4 0x3B9ACA00 EQ SWAP1 ISZERO OR ISZERO PUSH2 0x129 JUMPI DUP6 DUP1 SWAP4 PUSH2 0x2D3 PUSH2 0x2CD PUSH2 0x2D3 SWAP5 PUSH2 0x2D9 SWAP9 PUSH2 0x20F JUMP JUMPDEST DUP3 PUSH2 0x226 JUMP JUMPDEST SWAP4 PUSH2 0x3C1 JUMP JUMPDEST SWAP2 PUSH1 0x3 DUP2 LT ISZERO PUSH2 0x84 JUMPI PUSH2 0x34B JUMPI PUSH2 0x301 SWAP2 SWAP1 PUSH0 DUP2 SLT PUSH2 0x33C JUMPI SWAP1 JUMPDEST PUSH0 DUP2 SLT PUSH2 0x32E JUMPI PUSH2 0x16B JUMP JUMPDEST PUSH4 0x3B9ACA00 DUP2 SGT PUSH2 0x325 JUMPI PUSH4 0x3B9AC9FF NOT DUP2 SLT PUSH2 0x31B JUMPI SWAP1 JUMP JUMPDEST POP PUSH4 0x3B9AC9FF NOT SWAP1 JUMP JUMPDEST POP PUSH4 0x3B9ACA00 SWAP1 JUMP JUMPDEST PUSH2 0x337 SWAP1 PUSH2 0x233 JUMP JUMPDEST PUSH2 0x16B JUMP JUMPDEST PUSH2 0x345 SWAP1 PUSH2 0x233 JUMP JUMPDEST SWAP1 PUSH2 0x2F5 JUMP JUMPDEST PUSH2 0x354 SWAP2 PUSH2 0x16B JUMP JUMPDEST PUSH2 0x301 JUMP JUMPDEST PUSH0 PUSH2 0x284 JUMP JUMPDEST SWAP3 PUSH4 0x3B9ACA00 DUP2 SWAP4 SWAP3 SWAP4 MUL SWAP1 DUP1 DUP3 DIV PUSH4 0x3B9ACA00 EQ SWAP1 ISZERO OR ISZERO PUSH2 0x129 JUMPI PUSH2 0x2D3 DUP6 PUSH2 0x2D9 SWAP5 PUSH2 0x3B4 PUSH2 0x3AE DUP7 PUSH2 0x396 DUP6 SWAP9 DUP9 PUSH2 0x20F JUMP JUMPDEST DUP1 DUP6 GT ISZERO PUSH2 0x3BA JUMPI PUSH2 0x3A8 SWAP1 DUP6 PUSH2 0x219 JUMP JUMPDEST SWAP7 PUSH2 0x20F JUMP JUMPDEST DUP9 PUSH2 0x226 JUMP JUMPDEST SWAP7 PUSH2 0x3C1 JUMP JUMPDEST POP PUSH0 PUSH2 0x3A8 JUMP JUMPDEST SWAP2 SWAP1 PUSH2 0x3CD DUP2 DUP5 PUSH2 0x226 JUMP JUMPDEST SWAP2 DUP3 ISZERO PUSH2 0x442 JUMPI PUSH1 0x3 DUP2 LT ISZERO PUSH2 0x84 JUMPI DUP1 PUSH2 0x41D JUMPI POP POP DUP2 PUSH1 0x1 SHL SWAP2 DUP1 DUP4 SDIV PUSH1 0x2 EQ SWAP1 ISZERO OR ISZERO PUSH2 0x129 JUMPI PUSH2 0x403 PUSH2 0x408 SWAP3 PUSH2 0x10D JUMP JUMPDEST PUSH2 0x13D JUMP JUMPDEST PUSH4 0x3B9AC9FF NOT DUP2 ADD SWAP1 DUP2 SGT PUSH1 0x1 AND PUSH2 0x129 JUMPI SWAP1 JUMP JUMPDEST PUSH1 0x1 SUB PUSH2 0x434 JUMPI POP PUSH2 0x403 PUSH2 0x431 SWAP3 PUSH2 0x10D JUMP JUMPDEST SWAP1 JUMP JUMPDEST PUSH2 0x431 SWAP3 POP PUSH2 0x403 SWAP1 PUSH2 0x10D JUMP JUMPDEST POP POP POP POP PUSH0 SWAP1 JUMP INVALID LOG2 PUSH5 0x6970667358 0x22 SLT KECCAK256 PUSH10 0x6B635DD3174DC81FDC8E 0xCD 0x26 LOG1 0x2A PUSH25 0x971F6E35602316160D6CC5B49BCCE4A364736F6C634300081E STOP CALLER ","sourceMap":"170:973:1:-:0;;;;;;;;;;;;;;;;;"},"deployedBytecode":{"functionDebugData":{"checked_add_int256":{"entryPoint":387,"id":null,"parameterSlots":2,"returnSlots":1},"checked_add_uint256":{"entryPoint":550,"id":null,"parameterSlots":2,"returnSlots":1},"checked_div_int256":{"entryPoint":317,"id":null,"parameterSlots":2,"returnSlots":1},"checked_div_uint256":{"entryPoint":527,"id":null,"parameterSlots":2,"returnSlots":1},"checked_mul_int256":{"entryPoint":269,"id":null,"parameterSlots":1,"returnSlots":1},"checked_sub_int256":{"entryPoint":363,"id":null,"parameterSlots":2,"returnSlots":1},"checked_sub_uint256":{"entryPoint":537,"id":null,"parameterSlots":2,"returnSlots":1},"fun_calculateHalfSpreadWithInventory":{"entryPoint":414,"id":355,"parameterSlots":5,"returnSlots":1},"fun_calculateSkew":{"entryPoint":579,"id":191,"parameterSlots":6,"returnSlots":1},"fun_calculateSkewAtState":{"entryPoint":961,"id":277,"parameterSlots":3,"returnSlots":1},"negate_int256":{"entryPoint":563,"id":null,"parameterSlots":1,"returnSlots":1}},"generatedSources":[],"immutableReferences":{},"linkReferences":{},"object":"60806040526004361015610011575f80fd5b5f3560e01c80631abf44c91461009c57638acc7b7a1461002f575f80fd5b346100985760c03660031901126100985760643580151581036100985760843560ff81168091036100985760038110156100845760209161007c9160a43591604435602435600435610243565b604051908152f35b634e487b7160e01b5f52602160045260245ffd5b5f80fd5b346100985760a03660031901126100985760043563ffffffff811681036100985760243563ffffffff81168103610098576044359163ffffffff83168303610098576084359063ffffffff82168203610098576020936100ff936064359261019e565b63ffffffff60405191168152f35b90633b9aca00820291808305633b9aca00149015171561012957565b634e487b7160e01b5f52601160045260245ffd5b811561015757600160ff1b81145f19831416610129570590565b634e487b7160e01b5f52601260045260245ffd5b81810392915f13801582851316918412161761012957565b9190915f838201938412911290801582169115161761012957565b93909263ffffffff9091168082029291905f8212600160ff1b8214166101295781840514901517156101295763ffffffff6101ed6101fa9582806509184e72a0006101f597059716911661016b565b911690610183565b610183565b5f811261020a5763ffffffff1690565b505f90565b8115610157570490565b9190820391821161012957565b9190820180921161012957565b600160ff1b8114610129575f0390565b909492919394633b9aca00810290808204633b9aca001490151715610129578361026c9161020f565b911561035f5783811115610359576102848482610219565b938381029080820485149015171561012957633b9aca00900492633b9aca00840293808504633b9aca001490151715610129578580936102d36102cd6102d3946102d99861020f565b82610226565b936103c1565b9160038110156100845761034b5761030191905f811261033c57905b5f811261032e5761016b565b633b9aca00811361032557633b9ac9ff19811261031b5790565b50633b9ac9ff1990565b50633b9aca0090565b61033790610233565b61016b565b61034590610233565b906102f5565b6103549161016b565b610301565b5f610284565b92633b9aca00819392930290808204633b9aca001490151715610129576102d3856102d9946103b46103ae8661039685988861020f565b808511156103ba576103a89085610219565b9661020f565b88610226565b966103c1565b505f6103a8565b91906103cd8184610226565b918215610442576003811015610084578061041d5750508160011b9180830560021490151715610129576104036104089261010d565b61013d565b633b9ac9ff1981019081136001166101295790565b60010361043457506104036104319261010d565b90565b61043192506104039061010d565b505050505f9056fea2646970667358221220696b635dd3174dc81fdc8ecd26a12a78971f6e35602316160d6cc5b49bcce4a364736f6c634300081e0033","opcodes":"PUSH1 0x80 PUSH1 0x40 MSTORE PUSH1 0x4 CALLDATASIZE LT ISZERO PUSH2 0x11 JUMPI PUSH0 DUP1 REVERT JUMPDEST PUSH0 CALLDATALOAD PUSH1 0xE0 SHR DUP1 PUSH4 0x1ABF44C9 EQ PUSH2 0x9C JUMPI PUSH4 0x8ACC7B7A EQ PUSH2 0x2F JUMPI PUSH0 DUP1 REVERT JUMPDEST CALLVALUE PUSH2 0x98 JUMPI PUSH1 0xC0 CALLDATASIZE PUSH1 0x3 NOT ADD SLT PUSH2 0x98 JUMPI PUSH1 0x64 CALLDATALOAD DUP1 ISZERO ISZERO DUP2 SUB PUSH2 0x98 JUMPI PUSH1 0x84 CALLDATALOAD PUSH1 0xFF DUP2 AND DUP1 SWAP2 SUB PUSH2 0x98 JUMPI PUSH1 0x3 DUP2 LT ISZERO PUSH2 0x84 JUMPI PUSH1 0x20 SWAP2 PUSH2 0x7C SWAP2 PUSH1 0xA4 CALLDATALOAD SWAP2 PUSH1 0x44 CALLDATALOAD PUSH1 0x24 CALLDATALOAD PUSH1 0x4 CALLDATALOAD PUSH2 0x243 JUMP JUMPDEST PUSH1 0x40 MLOAD SWAP1 DUP2 MSTORE RETURN JUMPDEST PUSH4 0x4E487B71 PUSH1 0xE0 SHL PUSH0 MSTORE PUSH1 0x21 PUSH1 0x4 MSTORE PUSH1 0x24 PUSH0 REVERT JUMPDEST PUSH0 DUP1 REVERT JUMPDEST CALLVALUE PUSH2 0x98 JUMPI PUSH1 0xA0 CALLDATASIZE PUSH1 0x3 NOT ADD SLT PUSH2 0x98 JUMPI PUSH1 0x4 CALLDATALOAD PUSH4 0xFFFFFFFF DUP2 AND DUP2 SUB PUSH2 0x98 JUMPI PUSH1 0x24 CALLDATALOAD PUSH4 0xFFFFFFFF DUP2 AND DUP2 SUB PUSH2 0x98 JUMPI PUSH1 0x44 CALLDATALOAD SWAP2 PUSH4 0xFFFFFFFF DUP4 AND DUP4 SUB PUSH2 0x98 JUMPI PUSH1 0x84 CALLDATALOAD SWAP1 PUSH4 0xFFFFFFFF DUP3 AND DUP3 SUB PUSH2 0x98 JUMPI PUSH1 0x20 SWAP4 PUSH2 0xFF SWAP4 PUSH1 0x64 CALLDATALOAD SWAP3 PUSH2 0x19E JUMP JUMPDEST PUSH4 0xFFFFFFFF PUSH1 0x40 MLOAD SWAP2 AND DUP2 MSTORE RETURN JUMPDEST SWAP1 PUSH4 0x3B9ACA00 DUP3 MUL SWAP2 DUP1 DUP4 SDIV PUSH4 0x3B9ACA00 EQ SWAP1 ISZERO OR ISZERO PUSH2 0x129 JUMPI JUMP JUMPDEST PUSH4 0x4E487B71 PUSH1 0xE0 SHL PUSH0 MSTORE PUSH1 0x11 PUSH1 0x4 MSTORE PUSH1 0x24 PUSH0 REVERT JUMPDEST DUP2 ISZERO PUSH2 0x157 JUMPI PUSH1 0x1 PUSH1 0xFF SHL DUP2 EQ PUSH0 NOT DUP4 EQ AND PUSH2 0x129 JUMPI SDIV SWAP1 JUMP JUMPDEST PUSH4 0x4E487B71 PUSH1 0xE0 SHL PUSH0 MSTORE PUSH1 0x12 PUSH1 0x4 MSTORE PUSH1 0x24 PUSH0 REVERT JUMPDEST DUP2 DUP2 SUB SWAP3 SWAP2 PUSH0 SGT DUP1 ISZERO DUP3 DUP6 SGT AND SWAP2 DUP5 SLT AND OR PUSH2 0x129 JUMPI JUMP JUMPDEST SWAP2 SWAP1 SWAP2 PUSH0 DUP4 DUP3 ADD SWAP4 DUP5 SLT SWAP2 SLT SWAP1 DUP1 ISZERO DUP3 AND SWAP2 ISZERO AND OR PUSH2 0x129 JUMPI JUMP JUMPDEST SWAP4 SWAP1 SWAP3 PUSH4 0xFFFFFFFF SWAP1 SWAP2 AND DUP1 DUP3 MUL SWAP3 SWAP2 SWAP1 PUSH0 DUP3 SLT PUSH1 0x1 PUSH1 0xFF SHL DUP3 EQ AND PUSH2 0x129 JUMPI DUP2 DUP5 SDIV EQ SWAP1 ISZERO OR ISZERO PUSH2 0x129 JUMPI PUSH4 0xFFFFFFFF PUSH2 0x1ED PUSH2 0x1FA SWAP6 DUP3 DUP1 PUSH6 0x9184E72A000 PUSH2 0x1F5 SWAP8 SDIV SWAP8 AND SWAP2 AND PUSH2 0x16B JUMP JUMPDEST SWAP2 AND SWAP1 PUSH2 0x183 JUMP JUMPDEST PUSH2 0x183 JUMP JUMPDEST PUSH0 DUP2 SLT PUSH2 0x20A JUMPI PUSH4 0xFFFFFFFF AND SWAP1 JUMP JUMPDEST POP PUSH0 SWAP1 JUMP JUMPDEST DUP2 ISZERO PUSH2 0x157 JUMPI DIV SWAP1 JUMP JUMPDEST SWAP2 SWAP1 DUP3 SUB SWAP2 DUP3 GT PUSH2 0x129 JUMPI JUMP JUMPDEST SWAP2 SWAP1 DUP3 ADD DUP1 SWAP3 GT PUSH2 0x129 JUMPI JUMP JUMPDEST PUSH1 0x1 PUSH1 0xFF SHL DUP2 EQ PUSH2 0x129 JUMPI PUSH0 SUB SWAP1 JUMP JUMPDEST SWAP1 SWAP5 SWAP3 SWAP2 SWAP4 SWAP5 PUSH4 0x3B9ACA00 DUP2 MUL SWAP1 DUP1 DUP3 DIV PUSH4 0x3B9ACA00 EQ SWAP1 ISZERO OR ISZERO PUSH2 0x129 JUMPI DUP4 PUSH2 0x26C SWAP2 PUSH2 0x20F JUMP JUMPDEST SWAP2 ISZERO PUSH2 0x35F JUMPI DUP4 DUP2 GT ISZERO PUSH2 0x359 JUMPI PUSH2 0x284 DUP5 DUP3 PUSH2 0x219 JUMP JUMPDEST SWAP4 DUP4 DUP2 MUL SWAP1 DUP1 DUP3 DIV DUP6 EQ SWAP1 ISZERO OR ISZERO PUSH2 0x129 JUMPI PUSH4 0x3B9ACA00 SWAP1 DIV SWAP3 PUSH4 0x3B9ACA00 DUP5 MUL SWAP4 DUP1 DUP6 DIV PUSH4 0x3B9ACA00 EQ SWAP1 ISZERO OR ISZERO PUSH2 0x129 JUMPI DUP6 DUP1 SWAP4 PUSH2 0x2D3 PUSH2 0x2CD PUSH2 0x2D3 SWAP5 PUSH2 0x2D9 SWAP9 PUSH2 0x20F JUMP JUMPDEST DUP3 PUSH2 0x226 JUMP JUMPDEST SWAP4 PUSH2 0x3C1 JUMP JUMPDEST SWAP2 PUSH1 0x3 DUP2 LT ISZERO PUSH2 0x84 JUMPI PUSH2 0x34B JUMPI PUSH2 0x301 SWAP2 SWAP1 PUSH0 DUP2 SLT PUSH2 0x33C JUMPI SWAP1 JUMPDEST PUSH0 DUP2 SLT PUSH2 0x32E JUMPI PUSH2 0x16B JUMP JUMPDEST PUSH4 0x3B9ACA00 DUP2 SGT PUSH2 0x325 JUMPI PUSH4 0x3B9AC9FF NOT DUP2 SLT PUSH2 0x31B JUMPI SWAP1 JUMP JUMPDEST POP PUSH4 0x3B9AC9FF NOT SWAP1 JUMP JUMPDEST POP PUSH4 0x3B9ACA00 SWAP1 JUMP JUMPDEST PUSH2 0x337 SWAP1 PUSH2 0x233 JUMP JUMPDEST PUSH2 0x16B JUMP JUMPDEST PUSH2 0x345 SWAP1 PUSH2 0x233 JUMP JUMPDEST SWAP1 PUSH2 0x2F5 JUMP JUMPDEST PUSH2 0x354 SWAP2 PUSH2 0x16B JUMP JUMPDEST PUSH2 0x301 JUMP JUMPDEST PUSH0 PUSH2 0x284 JUMP JUMPDEST SWAP3 PUSH4 0x3B9ACA00 DUP2 SWAP4 SWAP3 SWAP4 MUL SWAP1 DUP1 DUP3 DIV PUSH4 0x3B9ACA00 EQ SWAP1 ISZERO OR ISZERO PUSH2 0x129 JUMPI PUSH2 0x2D3 DUP6 PUSH2 0x2D9 SWAP5 PUSH2 0x3B4 PUSH2 0x3AE DUP7 PUSH2 0x396 DUP6 SWAP9 DUP9 PUSH2 0x20F JUMP JUMPDEST DUP1 DUP6 GT ISZERO PUSH2 0x3BA JUMPI PUSH2 0x3A8 SWAP1 DUP6 PUSH2 0x219 JUMP JUMPDEST SWAP7 PUSH2 0x20F JUMP JUMPDEST DUP9 PUSH2 0x226 JUMP JUMPDEST SWAP7 PUSH2 0x3C1 JUMP JUMPDEST POP PUSH0 PUSH2 0x3A8 JUMP JUMPDEST SWAP2 SWAP1 PUSH2 0x3CD DUP2 DUP5 PUSH2 0x226 JUMP JUMPDEST SWAP2 DUP3 ISZERO PUSH2 0x442 JUMPI PUSH1 0x3 DUP2 LT ISZERO PUSH2 0x84 JUMPI DUP1 PUSH2 0x41D JUMPI POP POP DUP2 PUSH1 0x1 SHL SWAP2 DUP1 DUP4 SDIV PUSH1 0x2 EQ SWAP1 ISZERO OR ISZERO PUSH2 0x129 JUMPI PUSH2 0x403 PUSH2 0x408 SWAP3 PUSH2 0x10D JUMP JUMPDEST PUSH2 0x13D JUMP JUMPDEST PUSH4 0x3B9AC9FF NOT DUP2 ADD SWAP1 DUP2 SGT PUSH1 0x1 AND PUSH2 0x129 JUMPI SWAP1 JUMP JUMPDEST PUSH1 0x1 SUB PUSH2 0x434 JUMPI POP PUSH2 0x403 PUSH2 0x431 SWAP3 PUSH2 0x10D JUMP JUMPDEST SWAP1 JUMP JUMPDEST PUSH2 0x431 SWAP3 POP PUSH2 0x403 SWAP1 PUSH2 0x10D JUMP JUMPDEST POP POP POP POP PUSH0 SWAP1 JUMP INVALID LOG2 PUSH5 0x6970667358 0x22 SLT KECCAK256 PUSH10 0x6B635DD3174DC81FDC8E 0xCD 0x26 LOG1 0x2A PUSH25 0x971F6E35602316160D6CC5B49BCCE4A364736F6C634300081E STOP CALLER ","sourceMap":"170:973:1:-:0;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;-1:-1:-1;;170:973:1;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;543:183;170:973;;;;;;;;;;543:183;:::i;:::-;170:973;;;;;;;;;;;;;;;;;;;;;;;;;;;;-1:-1:-1;;170:973:1;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;964:170;170:973;;;964:170;;:::i;:::-;170:973;;;;;;;;;;5608:3:0;170:973:1;;;;;;5608:3:0;170:973:1;;;;;;;:::o;:::-;;;;-1:-1:-1;170:973:1;;;;;-1:-1:-1;170:973:1;;;;;;-1:-1:-1;;;170:973:1;;-1:-1:-1;;170:973:1;;;;;;;:::o;:::-;;;;;;;;;;;;;;;;;;;-1:-1:-1;170:973:1;;;;;;;;;;;;;:::o;:::-;;;;;;;;;;;;;;;;;;;;;;;;:::o;6505:1095:0:-;;;;170:973:1;;;;;;;;6505:1095:0;;170:973:1;;;-1:-1:-1;;;170:973:1;;;;;;;;;;;;;;;;7266:52:0;7422:35;7110:50;;;7156:4;7266:80;7110:50;170:973:1;;;;;7266:52:0;:::i;:::-;170:973:1;;7266:80:0;;:::i;:::-;7422:35;:::i;:::-;170:973:1;7514:15:0;;7510:29;;170:973:1;;6505:1095:0;:::o;7510:29::-;7531:8;170:973:1;7531:8:0;:::o;170:973:1:-;;;;;;;:::o;:::-;;;;;;;;;;:::o;:::-;;;;;;;;;;:::o;:::-;-1:-1:-1;;;170:973:1;;;;;;;:::o;2154:2460:0:-;;;;;;;2677:3;170:973:1;;;;;;2677:3:0;170:973:1;;;;;;;2660:35:0;;;;:::i;:::-;2774:19;2841:936;;;2926:22;;;;;;2951;;;;:::i;:::-;3111:20;170:973:1;;;;;;;;;;;;;;;2677:3:0;170:973:1;;;2677:3:0;170:973:1;;;;;;2677:3:0;170:973:1;;;;;;;3185:36:0;;;3249:37;3185:36;3858:60;3185:36;3947:58;3185:36;;:::i;:::-;3249:37;;:::i;:::-;2841:936;3858:60;:::i;3947:58::-;170:973:1;;;;;;;4125:35:0;;4337:28;;4199:42;-1:-1:-1;4199:15:0;;-1:-1:-1;;4199:42:0;;-1:-1:-1;4277:14:0;;-1:-1:-1;;4337:28:0;:::i;:::-;2677:3;4526:10;;4522:26;;-1:-1:-1;;4562:11:0;;4558:28;;2154:2460;:::o;4558:28::-;-1:-1:-1;;;4569:4:0;4575:11::o;4522:26::-;4538:10;2677:3;4538:10;:::o;4277:39::-;4306:10;;;:::i;:::-;4337:28;:::i;4199:42::-;4230:11;;;:::i;:::-;4199:42;;;4121:350;4438:22;;;:::i;:::-;4121:350;;2926:51;-1:-1:-1;2926:51:0;;2841:936;170:973:1;2677:3:0;170:973:1;;;;;;;;;2677:3:0;170:973:1;;;;;;;3858:60:0;3456:28;3947:58;3456:28;3736:30;3680:28;3456;;;;;;:::i;:::-;3512:29;;;;;;3544;;;;:::i;:::-;170:973:1;3680:28:0;:::i;:::-;3736:30;;:::i;:::-;2841:936;3858:60;:::i;3512:65::-;;-1:-1:-1;3512:65:0;;4735:915;;;4923:15;;;;:::i;:::-;4952;;;4948:29;;170:973:1;;;;;;5000:35:0;;;5180:18;;170:973:1;;;;;;;5197:1:0;170:973:1;;;;;;;5180:24:0;5179:47;5180:24;;:::i;:::-;5179:47;:::i;:::-;4569:4;;170:973:1;;;;;;;;;5240:18:0;:::o;4996:648::-;170:973:1;5315:34:0;170:973:1;;5430:20:0;;5429:43;5430:20;;:::i;5429:43::-;5422:50;:::o;5311:333::-;5590:43;5591:20;;;;;:::i;4948:29::-;4969:8;;;;170:973:1;4969:8:0;:::o"},"methodIdentifiers":{"calculateHalfSpreadWithInventory(uint32,uint32,uint32,int256,uint32)":"1abf44c9","calculateSkew(uint256,uint256,uint256,bool,uint8,uint256)":"8acc7b7a"}},"metadata":"{\"compiler\":{\"version\":\"0.8.30+commit.73712a01\"},\"language\":\"Solidity\",\"output\":{\"abi\":[{\"inputs\":[{\"internalType\":\"uint32\",\"name\":\"invKPpb\",\"type\":\"uint32\"},{\"internalType\":\"uint32\",\"name\":\"term2Ppb\",\"type\":\"uint32\"},{\"internalType\":\"uint32\",\"name\":\"term3Ppb\",\"type\":\"uint32\"},{\"internalType\":\"int256\",\"name\":\"skewPpb\",\"type\":\"int256\"},{\"internalType\":\"uint32\",\"name\":\"gammaStDev2Ppb\",\"type\":\"uint32\"}],\"name\":\"calculateHalfSpreadWithInventory\",\"outputs\":[{\"internalType\":\"uint32\",\"name\":\"\",\"type\":\"uint32\"}],\"stateMutability\":\"pure\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"inventory0Raw\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"inventory1Raw\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"internalType\":\"bool\",\"name\":\"zeroForOne\",\"type\":\"bool\"},{\"internalType\":\"uint8\",\"name\":\"riskyModeUint\",\"type\":\"uint8\"},{\"internalType\":\"uint256\",\"name\":\"midPricePpb\",\"type\":\"uint256\"}],\"name\":\"calculateSkew\",\"outputs\":[{\"internalType\":\"int256\",\"name\":\"\",\"type\":\"int256\"}],\"stateMutability\":\"pure\",\"type\":\"function\"}],\"devdoc\":{\"kind\":\"dev\",\"methods\":{},\"title\":\"InventorySkewTest\",\"version\":1},\"userdoc\":{\"kind\":\"user\",\"methods\":{},\"notice\":\"Test harness for InventorySkew library\",\"version\":1}},\"settings\":{\"compilationTarget\":{\"contracts/Peripheral/libraries/tests/InventorySkewTest.sol\":\"InventorySkewTest\"},\"evmVersion\":\"cancun\",\"libraries\":{},\"metadata\":{\"bytecodeHash\":\"ipfs\"},\"optimizer\":{\"enabled\":true,\"runs\":200},\"remappings\":[],\"viaIR\":true},\"sources\":{\"contracts/Peripheral/libraries/InventorySkew.sol\":{\"keccak256\":\"0x89305744ea99cc1e876ead3eb537cb095cca6d99d7e83021ec332790d4487d91\",\"license\":\"MIT\",\"urls\":[\"bzz-raw://78308b0e2c56c4c83154e8f215e131199772401a081c167473b283767cbca601\",\"dweb:/ipfs/QmSAknhrdfLgBvaHzXGzK5wMT5eHx4FQa3um9YM2XNnPsz\"]},\"contracts/Peripheral/libraries/tests/InventorySkewTest.sol\":{\"keccak256\":\"0x7c5414d46ee6c08feafcbad208bbb0763a169292474c97f0ce0f6ef422d18c72\",\"license\":\"MIT\",\"urls\":[\"bzz-raw://0e013443da0b926a2c103af85273e16e9e86fe3763ae7dacd29784622e1f1bb0\",\"dweb:/ipfs/QmYPDCuWpA3Sxjnvz5Mpd63AhQp6e9QuZ6k2A745tHRmR9\"]}},\"version\":1}"}}}}}